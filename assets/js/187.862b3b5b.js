(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{797:function(t,s,a){"use strict";a.r(s);var e=a(6),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"镜像其他相关操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像其他相关操作"}},[t._v("#")]),t._v(" 镜像其他相关操作")]),t._v(" "),a("h2",{attrs:{id:"_1-镜像备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-镜像备份"}},[t._v("#")]),t._v(" 1. 镜像备份")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("docker save")]),t._v(" 将指定镜像保存成 tar 归档文件。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" save "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" IMAGE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" save -o /root/mycentos7.tar mycentos:7\n")])])]),a("ul",[a("li",[a("code",[t._v("-o")]),t._v("：镜像打包后的归档文件输出的目录。")])]),t._v(" "),a("h2",{attrs:{id:"_2-镜像恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-镜像恢复"}},[t._v("#")]),t._v(" 2. 镜像恢复")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("docker load")]),t._v(" 导入 docker save 命令导出的镜像归档文件。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" load -i mycentos7.tar\n")])])]),a("ul",[a("li",[a("code",[t._v("--input, -i")]),t._v("：指定导入的文件；")]),t._v(" "),a("li",[a("code",[t._v("--quiet, -q")]),t._v("：精简输出信息。")])]),t._v(" "),a("h2",{attrs:{id:"_3-镜像迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-镜像迁移"}},[t._v("#")]),t._v(" 3. 镜像迁移")]),t._v(" "),a("p",[t._v("镜像迁移同时涉及到了上面两个操作，备份和恢复。")]),t._v(" "),a("p",[t._v("我们可以将任何一个 Docker 镜像从一台机器迁移到另一台机器。在迁移过程中，首先我们要把容器构建为 Docker 镜像。然后，该 Docker 镜像被作为 tar 包文件保存到本地。此时只需要拷贝或移动该镜像到我们想要的机器上，恢复该镜像并运行容器即可。")]),t._v(" "),a("h2",{attrs:{id:"_4-镜像仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-镜像仓库"}},[t._v("#")]),t._v(" 4. 镜像仓库")]),t._v(" "),a("h3",{attrs:{id:"_4-1-注册账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-注册账号"}},[t._v("#")]),t._v(" 4.1 注册账号")]),t._v(" "),a("p",[t._v("官网：https://hub.docker.com/")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200816174620320-16472332405102.png",alt:"docker"}})]),t._v(" "),a("h3",{attrs:{id:"_4-2-登录账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-登录账号"}},[t._v("#")]),t._v(" 4.2 登录账号")]),t._v(" "),a("p"),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("docker login")]),t._v(" 命令输入账号密码登录 DockerHub。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220314124931492.png",alt:"image-20220314124931492"}})]),t._v(" "),a("h3",{attrs:{id:"_4-3-推送镜像至仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-推送镜像至仓库"}},[t._v("#")]),t._v(" 4.3 推送镜像至仓库")]),t._v(" "),a("p",[t._v("需要先创建repository")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220314174759312.png",alt:"image-20220314174759312"}})]),t._v(" "),a("p",[t._v("先给镜像设置标签 "),a("code",[t._v("docker tag local-image:tagname new-repo:tagname")])]),t._v(" "),a("p",[t._v("再将镜像推送至仓库 "),a("code",[t._v("docker push new-repo:tagname")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag mscentos:7 mszlu/test-centos:1.0.0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push mszlu/test-centos:1.0.0\n")])])]),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220314125225011.png",alt:"image-20220314125225011"}})]),t._v(" "),a("h3",{attrs:{id:"_4-4-查看仓库镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-查看仓库镜像"}},[t._v("#")]),t._v(" 4.4 查看仓库镜像")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220314184348985.png",alt:"image-20220314184348985"}})]),t._v(" "),a("h3",{attrs:{id:"_4-5-拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-拉取镜像"}},[t._v("#")]),t._v(" 4.5 拉取镜像")]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("docker pull mszlu/test-centos:1.0.0")]),t._v(" 测试镜像是否可以拉取。")]),t._v(" "),a("h3",{attrs:{id:"_4-6-退出登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-退出登录"}},[t._v("#")]),t._v(" 4.6 退出登录")]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("docker logout")]),t._v(" 命令退出 DockerHub。")]),t._v(" "),a("h2",{attrs:{id:"_5-私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-私有仓库"}},[t._v("#")]),t._v(" 5. 私有仓库")]),t._v(" "),a("p",[t._v("DockerHub 为我们提供了很多官方镜像和个人上传的镜像，我们可以下载机构或个人提供的镜像，也可以上传我们自己的本地镜像，但缺点是：")]),t._v(" "),a("ul",[a("li",[t._v("由于网络的原因，从 DockerHub 下载和上传镜像速度可能会比较慢；")]),t._v(" "),a("li",[t._v("在生产上使用的 Docker 镜像可能包含我们的代码、配置信息等，不想被外部人员获取，只允许内网的开发人员下载。")])]),t._v(" "),a("p",[t._v("为了解决以上问题，Docker 官方提供了一个叫做 "),a("code",[t._v("registry")]),t._v(" 的镜像用于搭建本地私有仓库使用。在内部网络搭建的 Docker 私有仓库可以使内网人员下载、上传都非常快速，不受外网带宽等因素的影响，同时不在内网的人员也无法下载我们的镜像，并且私有仓库也支持配置仓库认证功能。")]),t._v(" "),a("h3",{attrs:{id:"_5-1-拉取私有仓库镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-拉取私有仓库镜像"}},[t._v("#")]),t._v(" 5.1 拉取私有仓库镜像")]),t._v(" "),a("p",[t._v("拉取私有仓库镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull registry\n")])])]),a("h3",{attrs:{id:"_5-2-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-修改配置"}},[t._v("#")]),t._v(" 5.2 修改配置")]),t._v(" "),a("p",[t._v("修改 daemon.json 文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/docker/daemon.json\n")])])]),a("p",[t._v("添加以下内容，用于让 Docker 信任私有仓库地址，保存退出")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.200.101:5000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("重新加载配置信息及重启 Docker 服务")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新加载某个服务的配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新启动 docker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"_5-3-创建私有仓库容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-创建私有仓库容器"}},[t._v("#")]),t._v(" 5.3 创建私有仓库容器")]),t._v(" "),a("p",[t._v("创建私有仓库容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -di --name registry -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5000 -v /mnt/docker/docker_registry:/var/lib/registry registry\n\n")])])]),a("ul",[a("li",[a("code",[t._v("-d")]),t._v("：后台运行容器；")]),t._v(" "),a("li",[a("code",[t._v("--name")]),t._v("：为创建的容器命名；")]),t._v(" "),a("li",[a("code",[t._v("-p")]),t._v("：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个 -p 做多个端口映射；")]),t._v(" "),a("li",[a("code",[t._v("-v")]),t._v("：将容器内 "),a("code",[t._v("/var/lib/registry")]),t._v(" 目录下的数据挂载至宿主机 "),a("code",[t._v("/mnt/docker/docker_registry")]),t._v(" 目录下；")])]),t._v(" "),a("p",[t._v("打开浏览器输入：http://ip:5000/v2/_catalog 看到 "),a("code",[t._v('{"repositories":[]}')]),t._v(" 表示私有仓库搭建成功。")]),t._v(" "),a("h3",{attrs:{id:"_5-4-推送镜像至私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-推送镜像至私有仓库"}},[t._v("#")]),t._v(" 5.4 推送镜像至私有仓库")]),t._v(" "),a("p",[t._v("先给镜像设置标签 "),a("code",[t._v("docker tag local-image:tagname new-repo:tagname")])]),t._v(" "),a("p",[t._v("再将镜像推送至私有仓库 "),a("code",[t._v("docker push new-repo:tagname")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag mscentos:7 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".200.101:5000/test-centos:1.0.0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".200.101:5000/test-centos:1.0.0\n")])])]),a("p",[t._v("打开浏览器输入：http://192.168.200.101:5000/v2/_catalog 可以看到私有仓库中已上传的镜像。")]),t._v(" "),a("p",[t._v("由于我们做了目录挂载，因此可以在宿主机 "),a("code",[t._v("/mnt/docker/docker_registry/docker/registry/v2/repositories")]),t._v(" 目录下查看。")]),t._v(" "),a("h3",{attrs:{id:"_5-5-配置私有仓库认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-配置私有仓库认证"}},[t._v("#")]),t._v(" 5.5 配置私有仓库认证")]),t._v(" "),a("p",[t._v("私有仓库已经搭建好了，要确保私有仓库的安全性，还需要一个安全认证证书，防止发生意想不到的事情。所以需要在搭建私有仓库的 Docker 主机上先生成自签名证书。")]),t._v(" "),a("p",[t._v("创建证书存储目录")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /usr/local/registry/certs\n")])])]),a("p",[t._v("生成自签名证书命令")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("openssl req -newkey rsa:2048 -nodes -sha256 -keyout /usr/local/registry/certs/domain.key -x509 -days "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" -out /usr/local/registry/certs/domain.crt\n\n")])])]),a("ul",[a("li",[a("code",[t._v("openssl req")]),t._v("：创建证书签名请求等功能；")]),t._v(" "),a("li",[a("code",[t._v("-newkey")]),t._v("：创建 CSR 证书签名文件和 RSA 私钥文件；")]),t._v(" "),a("li",[a("code",[t._v("rsa:2048")]),t._v("：指定创建的 RSA 私钥长度为 2048；")]),t._v(" "),a("li",[a("code",[t._v("-nodes")]),t._v("：对私钥不进行加密；")]),t._v(" "),a("li",[a("code",[t._v("-sha256")]),t._v("：使用 SHA256 算法；")]),t._v(" "),a("li",[a("code",[t._v("-keyout")]),t._v("：创建的私钥文件名称及位置；")]),t._v(" "),a("li",[a("code",[t._v("-x509")]),t._v("：自签发证书格式；")]),t._v(" "),a("li",[a("code",[t._v("-days")]),t._v("：证书有效期；")]),t._v(" "),a("li",[a("code",[t._v("-out")]),t._v("：指定 CSR 输出文件名称及位置；")])]),t._v(" "),a("h4",{attrs:{id:"_5-5-1-生成自签名证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-生成自签名证书"}},[t._v("#")]),t._v(" 5.5.1 生成自签名证书")]),t._v(" "),a("p",[t._v("通过 openssl 先生成自签名证书，运行命令以后需要填写一些证书信息，里面最关键的部分是："),a("code",[t._v("Common Name (eg, your name or your server's hostname) []:192.168.200.101")]),t._v("，这里填写的是私有仓库的地址。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openssl req -newkey rsa:2048 -nodes -sha256 -keyout /usr/local/registry/certs/domain.key -x509 -days 365 -out /usr/local/registry/certs/domain.crt")]),t._v("\nGenerating a "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" bit RSA private key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".+++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".+++\nwriting new private key to "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/registry/certs/domain.key'")]),t._v("\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),t._v(", the field will be left blank.\n-----\nCountry Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" letter code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":CN\nState or Province Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("full name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":BJ\nLocality Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Default City"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":BJ\nOrganization Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, company"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Default Company Ltd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":mszlu\nOrganizational Unit Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, section"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":mszlu\nCommon Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, your name or your server's "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":192.168.200.101\nEmail Address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":test@mszlu.com\n\n")])])]),a("h4",{attrs:{id:"_5-5-2-生成鉴权密码文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-2-生成鉴权密码文件"}},[t._v("#")]),t._v(" 5.5.2 生成鉴权密码文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建存储鉴权密码文件目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /usr/local/registry/auth\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果没有 htpasswd 功能需要安装 httpd")]),t._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y httpd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建用户和密码，-c创建文件，-b使用命令行中的密码，而不是提示输入密码，-B强制bcrypt加密密码（非常安全）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第一次生成时使用-c参数创建用户及密码文件，下次再生成时无需使用-c参数会追加至文件")]),t._v("\nhtpasswd -cbB /usr/local/registry/auth/htpasswd root root\n\n")])])]),a("p",[t._v("htpasswd 是 apache http 的基本认证文件，使用 htpasswd 命令可以生成用户及密码文件")]),t._v(" "),a("h4",{attrs:{id:"_5-5-3-创建私有仓库容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-3-创建私有仓库容器"}},[t._v("#")]),t._v(" 5.5.3 创建私有仓库容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -di --name registry -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -v /mydata/docker_registry:/var/lib/registry "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -v /usr/local/registry/certs:/certs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -v /usr/local/registry/auth:/auth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REGISTRY_AUTH=htpasswd"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("REGISTRY_AUTH_HTPASSWD_PATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/auth/htpasswd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("REGISTRY_HTTP_TLS_CERTIFICATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/certs/domain.crt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("REGISTRY_HTTP_TLS_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/certs/domain.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   registry\n\n")])])]),a("h4",{attrs:{id:"_5-5-4-推送镜像至私有仓库失败"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-4-推送镜像至私有仓库失败"}},[t._v("#")]),t._v(" 5.5.4 推送镜像至私有仓库失败")]),t._v(" "),a("p",[t._v("先给镜像设置标签 "),a("code",[t._v("docker tag local-image:tagname new-repo:tagname")])]),t._v(" "),a("p",[t._v("再将镜像推送至私有仓库 "),a("code",[t._v("docker push new-repo:tagname")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag mscentos:7 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".200.101:5000/test-centos:1.0.1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".200.101:5000/test-centos:1.0.1\n\n")])])]),a("p",[t._v("如果直接 push 镜像肯定会失败，并且出现 "),a("code",[t._v("no basic auth credentials")]),t._v(" 的错误，这是因为我们没有进行登录认证")]),t._v(" "),a("h4",{attrs:{id:"_5-5-5-登录账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-5-登录账号"}},[t._v("#")]),t._v(" 5.5.5 登录账号")]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("docker login")]),t._v(" 命令输入账号密码登录私有仓库")]),t._v(" "),a("p",[t._v("​\t再次 push 镜像，发现已经可以推送成功了")]),t._v(" "),a("p",[t._v("​\t通过 "),a("code",[t._v("docker logout")]),t._v(" 命令退出账号")])])}),[],!1,null,null,null);s.default=n.exports}}]);