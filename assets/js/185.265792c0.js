(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{791:function(s,t,a){"use strict";a.r(t);var e=a(6),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker部署"}},[s._v("#")]),s._v(" Docker部署")]),s._v(" "),a("h2",{attrs:{id:"_1-镜像分层原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-镜像分层原理"}},[s._v("#")]),s._v(" 1. 镜像分层原理")]),s._v(" "),a("blockquote",[a("p",[s._v("为什么centos镜像只有200多MB？")])]),s._v(" "),a("p",[s._v("因为centos镜像使用了宿主机的内核。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220312122525847.png",alt:"image-20220312122525847"}})]),s._v(" "),a("p",[a("strong",[s._v("base镜像的定义")])]),s._v(" "),a("ol",[a("li",[s._v("不依赖其他镜像，从scratch构建")]),s._v(" "),a("li",[s._v("其他镜像可以在其基础进行扩展")])]),s._v(" "),a("p",[s._v("base镜像一般都是各种Linux发行版本的Docker镜像，比如：Ubuntu，Debian或者CentOS等。")]),s._v(" "),a("p",[s._v("Linux操作系统由用户空间和内核空间构成。")]),s._v(" "),a("p",[s._v("内核空间是"),a("code",[s._v("kernel")]),s._v("，用户空间是"),a("code",[s._v("rootfs")]),s._v("，不同发行版的区别主要是rootfs。比如Ubuntu 14.04使用 upstart 管理服务，apt 管理软件包；而 CentOS 7 使用 systemd 和 yum。这些都是用户空间的不同，Kernel差别不大。")]),s._v(" "),a("p",[s._v("所以Docker可以同时支持多种 Linux 镜像，模拟出不同的操作系统环境。")]),s._v(" "),a("blockquote",[a("p",[s._v("为什么jdk的镜像有500多MB？")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220312123335633.png",alt:"image-20220312123335633"}})]),s._v(" "),a("p",[s._v("jdk镜像包含了rootfs和jdk本身，所以jdk的镜像要加上rootfs的大小，才是jdk镜像的大小。")]),s._v(" "),a("blockquote",[a("p",[s._v("为什么tomcat正常下载几十兆，镜像却要几百兆？")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220312133435172.png",alt:"image-20220312133435172"}})]),s._v(" "),a("p",[a("strong",[s._v("分层说明：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220312133514003.png",alt:"image-20220312133514003"}})]),s._v(" "),a("p",[a("strong",[s._v("修改时复制策略（copy-on-write）")])]),s._v(" "),a("p",[s._v("Docker通过一个修改时复制策略来保证base镜像的安全性，以及更高的性能和空间利用率。")]),s._v(" "),a("ul",[a("li",[s._v("当容器需要读取文件的时候")])]),s._v(" "),a("p",[s._v("从最上层的镜像层开始往下找，找到后读取到内存中，若已经在内存中，可以直接使用。换句话说，运行在同一台机器上的Docker容器共享运行时相同的文件。")]),s._v(" "),a("ul",[a("li",[s._v("当容器需要修改文件的时候")])]),s._v(" "),a("p",[s._v("从上往下查找，找到后复制到容器层，对于容器来说，可以看到的是容器层的这个文件，看不到镜像层里的文件，然后直接修改容器层的文件。")]),s._v(" "),a("ul",[a("li",[s._v("当容器需要删除文件的时候")])]),s._v(" "),a("p",[s._v("从上往下查找，找到后在容器中记录删除，并不是真正的删除，而是软删除。这导致镜像体积只会增加，不会减少。")]),s._v(" "),a("p",[s._v("当容器需要增加文件的时候\n直接在最上层的容器可写层增加，不会影响镜像层。")]),s._v(" "),a("h2",{attrs:{id:"_2-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署"}},[s._v("#")]),s._v(" 2. 部署")]),s._v(" "),a("h3",{attrs:{id:"_2-1-tomcat部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-tomcat部署"}},[s._v("#")]),s._v(" 2.1 tomcat部署")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull tomcat\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("创建容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --name tomcat -v /mnt/docker/tomcat/webapps:/usr/local/tomcat/webapps -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 tomcat\n")])])])]),s._v(" "),a("li",[a("p",[s._v("在webapps下添加ROOT文件夹，其中添加一个index.html")])]),s._v(" "),a("li",[a("p",[s._v("访问 http://ip:8080/index.html 即可")])])]),s._v(" "),a("h3",{attrs:{id:"_2-2-nginx部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-nginx部署"}},[s._v("#")]),s._v(" 2.2 nginx部署")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("拉取镜像")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx\n")])])])]),s._v(" "),a("li",[a("p",[s._v("创建容器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --name nginx -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 -v /mnt/docker/nginx:/etc/nginx nginx\n")])])])]),s._v(" "),a("li",[a("p",[s._v("访问 http://ip 即可")])]),s._v(" "),a("li",[a("p",[s._v("通过nginx访问tomcat")]),s._v(" "),a("p",[s._v("nginx.conf")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \tserver_name localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \tlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t\tproxy_pass http://172.17.0.2:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n")])])])]),s._v(" "),a("li",[a("p",[s._v("访问http://ip/index.html")])])]),s._v(" "),a("h3",{attrs:{id:"_2-3-mysql部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-mysql部署"}},[s._v("#")]),s._v(" 2.3 mysql部署")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("拉取镜像")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull mysql:5.7\n")])])])]),s._v(" "),a("li",[a("p",[s._v("创建镜像")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c_mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mnt/docker/mysql/conf:/etc/mysql/conf.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mnt/docker/mysql/logs:/logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mnt/docker/mysql/data:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nmysql:5.7\n")])])])]),s._v(" "),a("li",[a("p",[s._v("可以进入容器访问，也可以通过3307 外部访问")])])]),s._v(" "),a("h3",{attrs:{id:"_2-4-redis部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-redis部署"}},[s._v("#")]),s._v(" 2.4 Redis部署")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像。")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull redis\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --name redis -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 redis\n")])])]),a("p",[s._v("连接容器中的 Redis 时，只需要连接宿主机的 IP + 指定的映射端口即可。")]),s._v(" "),a("h3",{attrs:{id:"_2-5-mongodb部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-mongodb部署"}},[s._v("#")]),s._v(" 2.5 MongoDB部署")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull mongo\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --name mongo -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v(":27017 mongo\n")])])]),a("p",[s._v("连接容器中的 MongoDB 时，只需要连接宿主机的 IP + 指定的映射端口即可。")]),s._v(" "),a("h3",{attrs:{id:"_2-6-elasticsearch部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-elasticsearch部署"}},[s._v("#")]),s._v(" 2.6 Elasticsearch部署")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull elasticsearch:7.8.1\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器，为了方便演示，修改 ES 启动占用内存大小。")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ES_JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms256m -Xmx512m"')]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v(" -di --name es -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 -v /mnt/docker/es/plugins:/usr/share/elasticsearch/plugins elasticsearch:7.8.1\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("安装中文分词器")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it es /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装中文分词器 ")]),s._v("\nelasticsearch-plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.8.1/elasticsearch-analysis-ik-7.8.1.zip\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 es")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart es\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("访问：http://ip:9200/")])]),s._v(" "),a("h3",{attrs:{id:"_2-7-solr部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-solr部署"}},[s._v("#")]),s._v(" 2.7 Solr部署")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull solr\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("solr -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8983")]),s._v(":8983 solr\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("访问：http://ip:8983/solr/#/ 结果如下")])]),s._v(" "),a("h3",{attrs:{id:"_2-8-rabbitmq部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-rabbitmq部署"}},[s._v("#")]),s._v(" 2.8 RabbitMQ部署")]),s._v(" "),a("ol",[a("li",[s._v("拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull rabbitmq\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --name rabbitmq -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4369")]),s._v(":4369 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5671")]),s._v(":5671 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),s._v(":5672 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15671")]),s._v(":15671 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15672")]),s._v(":15672 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25672")]),s._v(":25672 rabbitmq\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("进入容器并开启管理功能")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it rabbitmq /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 RabbitMQ 管理功能")]),s._v("\nrabbitmq-plugins "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rabbitmq_management\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("访问：http://ip:15672/ 使用 "),a("code",[s._v("guest")]),s._v(" 登录账号密码")])])])}),[],!1,null,null,null);t.default=n.exports}}]);