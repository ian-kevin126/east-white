(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{801:function(s,a,t){"use strict";t.r(a);var r=t(6),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm"}},[s._v("#")]),s._v(" Docker Swarm")]),s._v(" "),t("p",[s._v("Docker Swarm 是 Docker 官方推出的容器集群管理工具，基于 Go 语言实现。代码开源在：https://github.com/docker/swarm 使用它可以将多个 Docker 主机封装为单个大型的虚拟 Docker 主机，快速打造一套容器云平台。")]),s._v(" "),t("p",[s._v("Docker Swarm 是生产环境中运行 Docker 应用程序最简单的方法。作为容器集群管理器，Swarm 最大的优势之一就是 100% 支持标准的 Docker API。各种基于标准 API 的工具比如 Compose、docker-py、各种管理软件，甚至 Docker 本身等都可以很容易的与 Swarm 进行集成。大大方便了用户将原先基于单节点的系统移植到 Swarm 上，同时 Swarm 内置了对 Docker 网络插件的支持，用户可以很容易地部署跨主机的容器集群服务。")]),s._v(" "),t("p",[s._v("Docker Swarm 和 Docker Compose 一样，都是 Docker 官方容器编排工具，但不同的是，"),t("strong",[s._v("Docker Compose")]),s._v(" 是一个在"),t("strong",[s._v("单个服务器或主机上创建多个容器的工具")]),s._v("，而 "),t("strong",[s._v("Docker Swarm")]),s._v(" 则可以在"),t("strong",[s._v("多个服务器或主机上创建容器集群服务")]),s._v("，对于微服务的部署，显然 Docker Swarm 会更加适合。")]),s._v(" "),t("h2",{attrs:{id:"_1-swarm-核心概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-swarm-核心概念"}},[s._v("#")]),s._v(" 1. Swarm 核心概念")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_1-1-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-swarm"}},[s._v("#")]),s._v(" 1.1 Swarm")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/logo-title-final-swarm-2d-copy.png",alt:"logo-title-final-swarm-2d-copy.png"}})]),s._v(" "),t("p",[s._v("Docker Engine 1.12 引入了 Swarm 模式，一个 Swarm 由多个 Docker 主机组成，它们以 Swarm 集群模式运行。Swarm 集群由 "),t("strong",[s._v("Manager 节点")]),s._v("（管理者角色，管理成员和委托任务）和 "),t("strong",[s._v("Worker 节点")]),s._v("（工作者角色，运行 Swarm 服务）组成。这些 Docker 主机有些是 Manager 节点，有些是 Worker 节点，或者同时扮演这两种角色。")]),s._v(" "),t("p",[s._v("Swarm 创建服务时，需要指定要使用的镜像、在运行的容器中执行的命令、定义其副本的数量、可用的网络和数据卷、将服务公开给外部的端口等等。与独立容器相比，集群服务的主要优势之一是，你可以修改服务的配置，包括它所连接的网络和数据卷等，而不需要手动重启服务。还有就是，如果一个 Worker Node 不可用了，Docker 会调度不可用 Node 的 Task 任务到其他 Nodes 上。")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_1-2-nodes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-nodes"}},[s._v("#")]),s._v(" 1.2 Nodes")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("Swarm 集群由 "),t("strong",[s._v("Manager 节点")]),s._v("（管理者角色，管理成员和委托任务）和 "),t("strong",[s._v("Worker 节点")]),s._v("（工作者角色，运行 Swarm 服务）组成。一个节点就是 Swarm 集群中的一个实例，也就是一个 Docker 主机。你可以运行一个或多个节点在单台物理机或云服务器上，但是生产环境上，典型的部署方式是：Docker 节点交叉分布式部署在多台物理机或云主机上。节点名称默认为机器的 hostname。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Manager")]),s._v("：负责整个集群的管理工作包括集群配置、服务管理、容器编排等所有跟集群有关的工作，它会选举出一个 leader 来指挥编排任务；")]),s._v(" "),t("li",[t("strong",[s._v("Worker")]),s._v("：工作节点接收和执行从管理节点分派的任务（Tasks）运行在相应的服务（Services）上。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/swarm-diagram.png",alt:"swarm-diagram.png"}})]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_1-3-services-and-tasks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-services-and-tasks"}},[s._v("#")]),s._v(" 1.3 Services and Tasks")]),s._v(" "),t("p"),s._v(" "),t("p",[t("strong",[s._v("服务")]),s._v("（Service）是一个抽象的概念，是对要在管理节点或工作节点上执行的"),t("strong",[s._v("任务的定义")]),s._v("。它是集群系统的中心结构，是用户与集群交互的主要根源。Swarm 创建服务时，可以为服务定义以下信息：")]),s._v(" "),t("ul",[t("li",[s._v("服务名称；")]),s._v(" "),t("li",[s._v("使用哪个镜像来创建容器；")]),s._v(" "),t("li",[s._v("要运行多少个副本；")]),s._v(" "),t("li",[s._v("服务的容器要连接到哪个网络上；")]),s._v(" "),t("li",[s._v("要映射哪些端口。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/services-diagram.png",alt:"services-diagram.png"}})]),s._v(" "),t("p",[t("strong",[s._v("任务")]),s._v("（Task）包括"),t("strong",[s._v("一个 Docker 容器")]),s._v("和"),t("strong",[s._v("在容器中运行的命令")]),s._v("。任务是一个集群的最小单元，任务与容器是一对一的关系。管理节点根据服务规模中设置的副本数量将任务分配给工作节点。一旦任务被分配到一个节点，便无法移动到另一个节点。它只能在分配的节点上运行或失败。")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_1-4-replicated-and-global-services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-replicated-and-global-services"}},[s._v("#")]),s._v(" 1.4 Replicated and global services")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("Swarm 不只是提供了优秀的高可用性，同时也提供了节点的"),t("strong",[s._v("弹性扩容和缩容")]),s._v("的功能。可以通过以下两种类型的 Services 部署实现：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Replicated Services")]),s._v("：当服务需要动态扩缩容时，只需通过 "),t("code",[s._v("scale")]),s._v(" 参数或者 "),t("code",[s._v("--replicas n")]),s._v(" 参数指定运行相同任务的数量，即可复制出新的副本，将一系列复制任务分发至各节点当中，这种操作便称之为"),t("strong",[s._v("副本服务")]),s._v("（Replicate）。")]),s._v(" "),t("li",[t("strong",[s._v("Global Services")]),s._v("：我们也可以通过 "),t("code",[s._v("--mode global")]),s._v(" 参数将服务分发至全部节点之上，这种操作我们称之为"),t("strong",[s._v("全局服务")]),s._v("（Global）。在每个节点上运行一个相同的任务，不需要预先指定任务的数量，每增加一个节点到 Swarm 中，协调器就会创建一个任务，然后调度器把任务分配给新节点。")])]),s._v(" "),t("p",[s._v("下图用黄色表示拥有三个副本服务 Replicated Service，用灰色表示拥有一个全局服务 Global Service。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/replicated-vs-global.png",alt:"replicated-vs-global.png"}})]),s._v(" "),t("p"),s._v(" "),t("h2",{attrs:{id:"_2-swarm-工作流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-swarm-工作流程"}},[s._v("#")]),s._v(" 2. Swarm 工作流程")]),s._v(" "),t("p"),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/service-lifecycle.png",alt:"service-lifecycle.png"}})]),s._v(" "),t("p",[s._v("Swarm Manager：")]),s._v(" "),t("ol",[t("li",[s._v("API：接受命令并创建 service 对象（创建对象）")]),s._v(" "),t("li",[s._v("orchestrator：为 service 对象创建的 task 进行编排工作（服务编排）")]),s._v(" "),t("li",[s._v("allocater：为各个 task 分配 IP 地址（分配 IP）")]),s._v(" "),t("li",[s._v("dispatcher：将 task 分发到 nodes（分发任务）")]),s._v(" "),t("li",[s._v("scheduler：安排一个 worker 节点运行 task（运行任务）")])]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("Worker Node：")]),s._v(" "),t("ol",[t("li",[s._v("worker：连接到调度器，检查分配的 task（检查任务）")]),s._v(" "),t("li",[s._v("executor：执行分配给 worker 节点的 task（执行任务）")])]),s._v(" "),t("p"),s._v(" "),t("h2",{attrs:{id:"_3-overlay-网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-overlay-网络"}},[s._v("#")]),s._v(" 3. Overlay 网络")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("关于 Docker 的网络我们在网络那个章节中已经给大家详细讲解过。")]),s._v(" "),t("p",[s._v("不过，Docker Swarm 集群模式下却默认使用的是 Overlay 网络（覆盖网络），这里简单介绍一下什么是 Overlay 网络。")]),s._v(" "),t("p",[s._v("Overlay 网络其实并不是一门新技术，它是指构建在另一个网络上的计算机网络，这是一种网络虚拟化技术的形式，近年来云计算虚拟化技术的演进促进了网络虚拟化技术的应用。所以 Overlay 网络就是建立在另一个计算机网络之上的虚拟网络，它是不能独立出现的，Overlay 底层依赖的网络就是 Underlay 网络。")]),s._v(" "),t("p",[s._v("Underlay 网络是专门用来承载用户 IP 流量的基础架构层，它与 Overlay 网络之间的关系有点类似物理机和虚拟机。Underlay 网络和物理机都是真正存在的实体，它们分别对应着真实存在的网络设备和计算设备，而 Overlay 网络和虚拟机都是依托在下层实体的基础之上，使用软件虚拟出来的层级。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/350c0c464af591b8a01655ca5bf233a4.png",alt:"350c0c464af591b8a01655ca5bf233a4.png"}})]),s._v(" "),t("p",[s._v("在 Docker 版本 1.12 以后 "),t("strong",[s._v("Swarm 模式原生已支持覆盖网络")]),s._v("（Overlay Network），只要是这个覆盖网络内的容器，不管在不在同一个宿主机上都能相互通信，即跨主机通信。不同覆盖网络内的容器之间是相互隔离的（相互 ping 不通）。")]),s._v(" "),t("p",[s._v("Overlay 网络是目前主流的容器跨节点数据传输和路由方案。当然，容器在跨主机进行通信的时候，除了可以使用 overlay 网络模式进行通信之外，还可以使用 host 网络模式，直接使用物理机的 IP 地址就可以进行通信")]),s._v(" "),t("h2",{attrs:{id:"_4-集群搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-集群搭建"}},[s._v("#")]),s._v(" 4. 集群搭建")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_4-1-环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-环境准备"}},[s._v("#")]),s._v(" 4.1 环境准备")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220314234645687.png",alt:"image-20220314234645687"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20220314234711759.png",alt:"image-20220314234711759"}})]),s._v(" "),t("ul",[t("li",[s._v("五台安装了 Docker 的 CentOS 机器，版本为："),t("code",[s._v("CentOS 7.8.2003")])]),s._v(" "),t("li",[s._v("Docker Engine 1.12+（最低要求 1.12）")]),s._v(" "),t("li",[s._v("防火墙开启以下端口或者关闭防火墙：\n"),t("ul",[t("li",[s._v("TCP 端口 2377，用于集群管理通信；")]),s._v(" "),t("li",[s._v("TCP 和 UDP 端口 7946，用于节点之间通信；")]),s._v(" "),t("li",[s._v("UDP 端口 4789，用于覆盖网络。")])])])]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_4-2-机器分布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-机器分布"}},[s._v("#")]),s._v(" 4.2 机器分布")]),s._v(" "),t("p"),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("角色")]),s._v(" "),t("th",[s._v("IP")]),s._v(" "),t("th",[s._v("HOSTNAME")]),s._v(" "),t("th",[s._v("Docker 版本")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Manager")]),s._v(" "),t("td",[s._v("192.168.200.101")]),s._v(" "),t("td",[s._v("manager1")]),s._v(" "),t("td",[s._v("20.10.13")])]),s._v(" "),t("tr",[t("td",[s._v("Manager")]),s._v(" "),t("td",[s._v("192.168.200.102")]),s._v(" "),t("td",[s._v("manager2")]),s._v(" "),t("td",[s._v("20.10.13")])]),s._v(" "),t("tr",[t("td",[s._v("Manager")]),s._v(" "),t("td",[s._v("192.168.200.103")]),s._v(" "),t("td",[s._v("manager3")]),s._v(" "),t("td",[s._v("20.10.13")])]),s._v(" "),t("tr",[t("td",[s._v("Worker")]),s._v(" "),t("td",[s._v("192.168.200.104")]),s._v(" "),t("td",[s._v("worker1")]),s._v(" "),t("td",[s._v("20.10.13")])]),s._v(" "),t("tr",[t("td",[s._v("Worker")]),s._v(" "),t("td",[s._v("192.168.200.105")]),s._v(" "),t("td",[s._v("worker2")]),s._v(" "),t("td",[s._v("20.10.13")])])])]),s._v(" "),t("ul",[t("li",[s._v("可以通过 "),t("code",[s._v("hostname 主机名")]),s._v(" 修改机器的主机名（立即生效，重启后失效）；")]),s._v(" "),t("li",[s._v("或者 "),t("code",[s._v("hostnamectl set-hostname 主机名")]),s._v(" 修改机器的主机名（立即生效，重启也生效）；")]),s._v(" "),t("li",[s._v("或者 "),t("code",[s._v("vi /etc/hosts")]),s._v(" 编辑 hosts 文件，如下所示， 给 127.0.0.1 添加主机名（重启生效）。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1   manager1 localhost \n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n")])])]),t("h3",{attrs:{id:"_4-3-创建集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-创建集群"}},[s._v("#")]),s._v(" 4.3 创建集群")]),s._v(" "),t("p",[s._v("在任意节点下通过 "),t("code",[s._v("docker swarm init")]),s._v(" 命令创建一个新的 Swarm 集群并加入，且该节点会默认成为 Manager 节点。根据我们预先定义的角色，在 101 ~ 103 的任意一台机器上运行该命令即可。")]),s._v(" "),t("p",[s._v("通常，第一个加入集群的管理节点将成为 "),t("code",[s._v("Leader")]),s._v("，后来加入的管理节点都是 "),t("code",[s._v("Reachable")]),s._v("。当前的 Leader 如果挂掉，所有的 Reachable 将重新选举一个新的 Leader。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker swarm init --advertise-addr 192.168.200.101")]),s._v("\nSwarm initialized: current "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clumstpieg0qzzxt1caeazg8g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" is now a manager.\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" a worker to this swarm, run the following command:\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" --token SWMTKN-1-5ob7jlej85qsygxubqypjuftiwruvew8e2cr4u3iuo4thxyrhg-3hbf2u3i1iagurdprl3n3yra1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.101:2377\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" a manager to this swarm, run "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker swarm join-token manager'")]),s._v(" and follow the instructions.\n\n")])])]),t("p"),s._v(" "),t("h3",{attrs:{id:"_4-4-加入集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-加入集群"}},[s._v("#")]),s._v(" 4.4 加入集群")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("Docker 中内置的集群模式自带了公钥基础设施(PKI)系统，使得安全部署容器变得简单。集群中的节点使用传输层安全协议(TLS)对集群中其他节点的通信进行身份验证、授权和加密。")]),s._v(" "),t("p",[s._v("默认情况下，通过 "),t("code",[s._v("docker swarm init")]),s._v(" 命令创建一个新的 Swarm 集群时，Manager 节点会生成新的根证书颁发机构（CA）和密钥对，用于保护与加入集群的其他节点之间的通信安全。")]),s._v(" "),t("p",[s._v("Manager 节点会生成两个令牌，供其他节点加入集群时使用：一个 Worker 令牌，一个 Manager 令牌。每个令牌都包括根 CA 证书的摘要和随机生成的密钥。当节点加入群集时，加入的节点使用摘要来验证来自远程管理节点的根 CA 证书。远程管理节点使用密钥来确保加入的节点是批准的节点。")]),s._v(" "),t("p"),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/tls.png",alt:"ca"}})]),s._v(" "),t("p"),s._v(" "),t("h4",{attrs:{id:"manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manager"}},[s._v("#")]),s._v(" Manager")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("若要向该集群添加 Manager 节点，管理节点先运行 "),t("code",[s._v("docker swarm join-token manager")]),s._v(" 命令查看管理节点的令牌信息。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token manager\n")])])]),t("p",[s._v("然后在其他节点上运行 "),t("code",[s._v("docker swarm join")]),s._v(" 并携带令牌参数加入 Swarm 集群，该节点角色为 Manager。")]),s._v(" "),t("h4",{attrs:{id:"worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worker"}},[s._v("#")]),s._v(" Worker")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("要向这个集群添加一个 Worker 节点，管理节点先运行 "),t("code",[s._v("docker swarm join-token worker")]),s._v(" 命令查看工作节点的令牌信息。")]),s._v(" "),t("p",[s._v("然后在其他节点上运行 "),t("code",[s._v("docker swarm join")]),s._v(" 并携带令牌参数加入 Swarm 集群，该节点角色为 Worker。")]),s._v(" "),t("h3",{attrs:{id:"_4-5-查看集群信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-查看集群信息"}},[s._v("#")]),s._v(" 4.5 查看集群信息")]),s._v(" "),t("p",[s._v("在任意 Manager 节点中运行 "),t("code",[s._v("docker info")]),s._v(" 可以查看当前集群的信息。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916170832333-164727319732027.png",alt:"image1"}})]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_4-6-查看集群节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-查看集群节点"}},[s._v("#")]),s._v(" 4.6 查看集群节点")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("在任意 Manager 节点中运行 "),t("code",[s._v("docker node ls")]),s._v(" 可以查看当前集群节点信息。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" \n")])])]),t("blockquote",[t("p",[t("code",[s._v("*")]),s._v(" 代表当前节点，现在的环境为 3 个管理节点构成 1 主 2 从，以及 2 个工作节点。")])]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("节点 "),t("code",[s._v("MANAGER STATUS")]),s._v(" 说明：表示节点是属于 Manager 还是 Worker，没有值则属于 Worker 节点。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Leader")]),s._v("：该节点是管理节点中的主节点，负责该集群的集群管理和编排决策；")]),s._v(" "),t("li",[t("code",[s._v("Reachable")]),s._v("：该节点是管理节点中的从节点，如果 Leader 节点不可用，该节点有资格被选为新的 Leader；")]),s._v(" "),t("li",[t("code",[s._v("Unavailable")]),s._v("：该管理节点已不能与其他管理节点通信。如果管理节点不可用，应该将新的管理节点加入群集，或者将工作节点升级为管理节点。")])]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("节点 "),t("code",[s._v("AVAILABILITY")]),s._v(" 说明：表示调度程序是否可以将任务分配给该节点。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Active")]),s._v("：调度程序可以将任务分配给该节点；")]),s._v(" "),t("li",[t("code",[s._v("Pause")]),s._v("：调度程序不会将新任务分配给该节点，但现有任务仍可以运行；")]),s._v(" "),t("li",[t("code",[s._v("Drain")]),s._v("：调度程序不会将新任务分配给该节点，并且会关闭该节点所有现有任务，并将它们调度在可用的节点上。")])]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_4-7-删除节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-删除节点"}},[s._v("#")]),s._v(" 4.7 删除节点")]),s._v(" "),t("p"),s._v(" "),t("h4",{attrs:{id:"manager-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manager-2"}},[s._v("#")]),s._v(" Manager")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("删除节点之前需要先将该节点的 "),t("code",[s._v("AVAILABILITY")]),s._v(" 改为 "),t("code",[s._v("Drain")]),s._v("。其目的是为了将该节点的服务迁移到其他可用节点上，确保服务正常。最好检查一下容器迁移情况，确保这一步已经处理完成再继续往下。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" update --availability drain 节点名称"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("节点ID\n")])])]),t("p",[s._v("然后，将该 Manager 节点进行降级处理，降级为 Worker 节点。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" demote 节点名称"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("节点ID\n")])])]),t("p",[s._v("然后，在已经降级为 Worker 的节点中运行以下命令，离开集群。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm leave\n")])])]),t("p",[s._v("最后，在管理节点中对刚才离开的节点进行删除。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 节点名称"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("节点ID\n")])])]),t("h4",{attrs:{id:"worker-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worker-2"}},[s._v("#")]),s._v(" Worker")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("删除节点之前需要先将该节点的 "),t("code",[s._v("AVAILABILITY")]),s._v(" 改为 "),t("code",[s._v("Drain")]),s._v("。其目的是为了将该节点的服务迁移到其他可用节点上，确保服务正常。最好检查一下容器迁移情况，确保这一步已经处理完成再继续往下。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" update --availability drain 节点名称"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("节点ID\n")])])]),t("p",[s._v("然后，在准备删除的 Worker 节点中运行以下命令，离开集群。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm leave\n")])])]),t("p",[s._v("最后，在管理节点中对刚才离开的节点进行删除。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 节点名称"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("节点ID\n")])])]),t("h2",{attrs:{id:"_5-服务部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-服务部署"}},[s._v("#")]),s._v(" 5. 服务部署")]),s._v(" "),t("p"),s._v(" "),t("blockquote",[t("p",[s._v("注意：跟集群管理有关的任何操作，都是在 Manager 节点上操作的。")])]),s._v(" "),t("p"),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果出现manager不能用的情况 请重新选举")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm init --force-new-cluster\n")])])]),t("h3",{attrs:{id:"_5-1-创建服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-创建服务"}},[s._v("#")]),s._v(" 5.1 创建服务")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("下面这个案例，使用 nginx 镜像创建了一个名为 mynginx 的服务，该服务会被随机指派给一个工作节点运行。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create --replicas "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --name mynginx -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 nginx\n")])])]),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916174617388.png",alt:"2"}})]),s._v(" "),t("ul",[t("li",[t("code",[s._v("docker service create")]),s._v("：创建服务；")]),s._v(" "),t("li",[t("code",[s._v("--replicas")]),s._v("：指定一个服务有几个实例运行；")]),s._v(" "),t("li",[t("code",[s._v("--name")]),s._v("：服务名称。")])]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_5-2-查看服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-查看服务"}},[s._v("#")]),s._v(" 5.2 查看服务")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("可以通过 "),t("code",[s._v("docker service ls")]),s._v(" 查看运行的服务。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@manager1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker service ls")]),s._v("\nID                NAME           MODE              REPLICAS        IMAGE              PORTS\nhepx06k5ik5n      mynginx        replicated        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1             nginx:latest       *:80-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp\n\n")])])]),t("p"),s._v(" "),t("p",[s._v("可以通过 "),t("code",[s._v("docker service inspect 服务名称|服务ID")]),s._v(" 查看服务的详细信息。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@manager1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker service inspect mynginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ID"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k0dbjg1zzy3l3g71kdwa56ect"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Version"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CreatedAt"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-09-16T10:05:55.627974095Z"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UpdatedAt"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-09-16T10:05:55.629507771Z"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Spec"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mynginx"')]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TaskTemplate"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ContainerSpec"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Image"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx:latest@sha256:c628b67d21744fce822d22fdcc0389f6bd763daac23a6b77147d0712ea7102d0"')]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Init"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StopGracePeriod"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000000000")]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DNSConfig"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Isolation"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Resources"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Limits"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Reservations"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RestartPolicy"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Condition"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"any"')]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Delay"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000000000")]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MaxAttempts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Placement"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Platforms"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"amd64"')]),s._v(",\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"arm64"')]),s._v(",\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"386"')]),s._v(",\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mips64le"')]),s._v(",\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ppc64le"')]),s._v(",\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s390x"')]),s._v(",\n                            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ForceUpdate"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Runtime"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"container"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Replicated"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Replicas"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UpdateConfig"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Parallelism"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FailureAction"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pause"')]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Monitor"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000000000")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MaxFailureRatio"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Order"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stop-first"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RollbackConfig"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Parallelism"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FailureAction"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pause"')]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Monitor"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000000000")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MaxFailureRatio"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Order"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stop-first"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointSpec"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vip"')]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ports"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Protocol"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp"')]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TargetPort"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PublishedPort"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PublishMode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ingress"')]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Endpoint"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Spec"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vip"')]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ports"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Protocol"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp"')]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TargetPort"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PublishedPort"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(",\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PublishMode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ingress"')]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ports"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Protocol"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp"')]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TargetPort"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PublishedPort"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PublishMode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ingress"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VirtualIPs"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NetworkID"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"st2xiy7pjzap093wz4w4u6nbs"')]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Addr"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.15/24"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])])]),t("p",[s._v("可以通过 "),t("code",[s._v("docker service ps 服务名称|服务ID")]),s._v(" 查看服务运行在哪些节点上。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916180732731.png",alt:"3"}})]),s._v(" "),t("p",[s._v("在对应的任务节点上运行 "),t("code",[s._v("docker ps")]),s._v(" 可以查看该服务对应容器的相关信息。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916181108430.png",alt:"4"}})]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_5-3-调用服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-调用服务"}},[s._v("#")]),s._v(" 5.3 调用服务")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("接下来我们测试一下服务是否能被正常访问，并且该集群下任意节点的 IP 地址都要能访问到该服务才行。")]),s._v(" "),t("p",[s._v("测试结果：5 台机器均可正常访问到该服务。")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_5-4-弹性服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-弹性服务"}},[s._v("#")]),s._v(" 5.4 弹性服务")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("将 service 部署到集群以后，可以通过命令弹性扩缩容 service 中的容器数量。在 service 中运行的容器被称为 task（任务）。")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("docker service scale 服务名称|服务ID=n")]),s._v(" 可以将 service 运行的任务扩缩容为 n 个。")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("docker service update --replicas n 服务名称|服务ID")]),s._v(" 也可以达到扩缩容的效果。")]),s._v(" "),t("p",[s._v("将 mynginx service 运行的任务扩展为 5 个：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@manager1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker service scale mynginx=5")]),s._v("\nmynginx scaled to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\noverall progress: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" out of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" tasks \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/5: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/5: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/5: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/5: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/5: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nverify: Service converged\n\n")])])]),t("p",[s._v("通过 "),t("code",[s._v("docker service ps 服务名称|服务ID")]),s._v(" 查看服务运行在哪些节点上。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916184241258.png",alt:"5"}})]),s._v(" "),t("p",[s._v("我们再来一波缩容的操作，命令如下：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@manager1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker service update --replicas 3 mynginx")]),s._v("\nmynginx\noverall progress: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" tasks \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/3: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/3: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3: running   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nverify: Service converged\n\n")])])]),t("p",[s._v("通过 "),t("code",[s._v("docker service ps 服务名称|服务ID")]),s._v(" 查看服务运行在哪些节点上。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916184353904.png",alt:"6"}})]),s._v(" "),t("p",[s._v("在 Swarm 集群模式下真正意义实现了所谓的"),t("strong",[s._v("弹性服务")]),s._v("，动态扩缩容一行命令搞定，简单、便捷、强大。")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_5-5-删除服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-删除服务"}},[s._v("#")]),s._v(" 5.5 删除服务")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("docker service rm 服务名称|服务ID")]),s._v(" 即可删除服务。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@manager1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker service rm mynginx")]),s._v("\nmynginx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@manager1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker service ls")]),s._v("\nID                NAME              MODE              REPLICAS          IMAGE             PORTS\n\n")])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"_6-滚动更新及回滚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-滚动更新及回滚"}},[s._v("#")]),s._v(" 6. 滚动更新及回滚")]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("以下案例将演示 Redis 版本如何滚动升级至更高版本再回滚至上一次的操作。")]),s._v(" "),t("p",[s._v("首先，创建 5 个 Redis 服务副本，版本为 5，详细命令如下：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 5 个副本，每次更新 2 个，更新间隔 10s，20% 任务失败继续执行，超出 20% 执行回滚，每次回滚 2 个")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create --replicas "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" --name redis "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--update-delay 10s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--update-parallelism "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--update-failure-action "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--rollback-monitor 20s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--rollback-parallelism "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--rollback-max-failure-ratio "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nredis:5\n\n")])])]),t("ul",[t("li",[t("code",[s._v("--update-delay")]),s._v("：定义滚动更新的时间间隔；")]),s._v(" "),t("li",[t("code",[s._v("--update-parallelism")]),s._v("：定义并行更新的副本数量，默认为 1；")]),s._v(" "),t("li",[t("code",[s._v("--update-failure-action")]),s._v("：定义容器启动失败之后所执行的动作；")]),s._v(" "),t("li",[t("code",[s._v("--rollback-monitor")]),s._v("：定义回滚的监控时间；")]),s._v(" "),t("li",[t("code",[s._v("--rollback-parallelism")]),s._v("：定义并行回滚的副本数量；")]),s._v(" "),t("li",[t("code",[s._v("--rollback-max-failure-ratio")]),s._v("：任务失败回滚比率，超过该比率执行回滚操作，0.2 表示 20%。")])]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("然后通过以下命令实现服务的滚动更新。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" update --image redis:6 redis\n")])])]),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916231330724.png",alt:"8"}})]),s._v(" "),t("p"),s._v(" "),t("p",[s._v("回滚服务，只能回滚到上一次操作的状态，并不能连续回滚到指定操作。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" update --rollback redis\n")])])]),t("p",[t("img",{attrs:{src:"https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/image-20200916231710227.png",alt:"10"}})]),s._v(" "),t("p"),s._v(" "),t("h2",{attrs:{id:"_7-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-常用命令"}},[s._v("#")]),s._v(" 7. 常用命令")]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_7-1-docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-docker-swarm"}},[s._v("#")]),s._v(" 7.1 docker swarm")]),s._v(" "),t("p"),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("命令")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("docker swarm init")]),s._v(" "),t("td",[s._v("初始化集群")])]),s._v(" "),t("tr",[t("td",[s._v("docker swarm join-token worker")]),s._v(" "),t("td",[s._v("查看工作节点的 token")])]),s._v(" "),t("tr",[t("td",[s._v("docker swarm join-token manager")]),s._v(" "),t("td",[s._v("查看管理节点的 token")])]),s._v(" "),t("tr",[t("td",[s._v("docker swarm join")]),s._v(" "),t("td",[s._v("加入集群")])])])]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_7-2-docker-node"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-docker-node"}},[s._v("#")]),s._v(" 7.2 docker node")]),s._v(" "),t("p"),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("命令")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("docker node ls")]),s._v(" "),t("td",[s._v("查看集群所有节点")])]),s._v(" "),t("tr",[t("td",[s._v("docker node ps")]),s._v(" "),t("td",[s._v("查看当前节点所有任务")])]),s._v(" "),t("tr",[t("td",[s._v("docker node rm 节点名称|节点ID")]),s._v(" "),t("td",[s._v("删除节点（"),t("code",[s._v("-f")]),s._v("强制删除）")])]),s._v(" "),t("tr",[t("td",[s._v("docker node inspect 节点名称|节点ID")]),s._v(" "),t("td",[s._v("查看节点详情")])]),s._v(" "),t("tr",[t("td",[s._v("docker node demote 节点名称|节点ID")]),s._v(" "),t("td",[s._v("节点降级，由管理节点降级为工作节点")])]),s._v(" "),t("tr",[t("td",[s._v("docker node promote 节点名称|节点ID")]),s._v(" "),t("td",[s._v("节点升级，由工作节点升级为管理节点")])]),s._v(" "),t("tr",[t("td",[s._v("docker node update 节点名称|节点ID")]),s._v(" "),t("td",[s._v("更新节点")])])])]),s._v(" "),t("p"),s._v(" "),t("h3",{attrs:{id:"_7-3-docker-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-docker-service"}},[s._v("#")]),s._v(" 7.3 docker service")]),s._v(" "),t("p"),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("命令")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("docker service create")]),s._v(" "),t("td",[s._v("创建服务")])]),s._v(" "),t("tr",[t("td",[s._v("docker service ls")]),s._v(" "),t("td",[s._v("查看所有服务")])]),s._v(" "),t("tr",[t("td",[s._v("docker service inspect 服务名称|服务ID")]),s._v(" "),t("td",[s._v("查看服务详情")])]),s._v(" "),t("tr",[t("td",[s._v("docker service logs 服务名称|服务ID")]),s._v(" "),t("td",[s._v("查看服务日志")])]),s._v(" "),t("tr",[t("td",[s._v("docker service rm 服务名称|服务ID")]),s._v(" "),t("td",[s._v("删除服务（"),t("code",[s._v("-f")]),s._v("强制删除）")])]),s._v(" "),t("tr",[t("td",[s._v("docker service scale 服务名称|服务ID=n")]),s._v(" "),t("td",[s._v("设置服务数量")])]),s._v(" "),t("tr",[t("td",[s._v("docker service update 服务名称|服务ID")]),s._v(" "),t("td",[s._v("更新服务")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);