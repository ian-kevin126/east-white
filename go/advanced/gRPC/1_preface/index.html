<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、ProtoBuf | east-white</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="east-white&#39;s Blog">
    
    <link rel="preload" href="/east-white/assets/css/0.styles.8b454665.css" as="style"><link rel="preload" href="/east-white/assets/js/app.66c0ecb2.js" as="script"><link rel="preload" href="/east-white/assets/js/3.688d5389.js" as="script"><link rel="preload" href="/east-white/assets/js/1.66f91b48.js" as="script"><link rel="preload" href="/east-white/assets/js/42.2b7e1b2a.js" as="script"><link rel="prefetch" href="/east-white/assets/js/10.90295e74.js"><link rel="prefetch" href="/east-white/assets/js/100.fd613351.js"><link rel="prefetch" href="/east-white/assets/js/101.2f81bcdf.js"><link rel="prefetch" href="/east-white/assets/js/102.4dce3828.js"><link rel="prefetch" href="/east-white/assets/js/103.20d0eb5e.js"><link rel="prefetch" href="/east-white/assets/js/104.d45bfdf7.js"><link rel="prefetch" href="/east-white/assets/js/105.6dfabe59.js"><link rel="prefetch" href="/east-white/assets/js/106.0f9bbcce.js"><link rel="prefetch" href="/east-white/assets/js/107.a90a0f6a.js"><link rel="prefetch" href="/east-white/assets/js/108.9f211e81.js"><link rel="prefetch" href="/east-white/assets/js/109.1da389c6.js"><link rel="prefetch" href="/east-white/assets/js/11.bdf77d8b.js"><link rel="prefetch" href="/east-white/assets/js/110.ef3b7270.js"><link rel="prefetch" href="/east-white/assets/js/111.6515c5bd.js"><link rel="prefetch" href="/east-white/assets/js/112.8ae3f3eb.js"><link rel="prefetch" href="/east-white/assets/js/113.1d042c40.js"><link rel="prefetch" href="/east-white/assets/js/114.f27875f7.js"><link rel="prefetch" href="/east-white/assets/js/115.d03488be.js"><link rel="prefetch" href="/east-white/assets/js/116.d6f6f17e.js"><link rel="prefetch" href="/east-white/assets/js/117.2127938a.js"><link rel="prefetch" href="/east-white/assets/js/118.57f16ef5.js"><link rel="prefetch" href="/east-white/assets/js/119.8180ce9c.js"><link rel="prefetch" href="/east-white/assets/js/12.50cfb5a6.js"><link rel="prefetch" href="/east-white/assets/js/120.3d30999e.js"><link rel="prefetch" href="/east-white/assets/js/121.d4070915.js"><link rel="prefetch" href="/east-white/assets/js/122.2d3a08f6.js"><link rel="prefetch" href="/east-white/assets/js/123.2080f2dc.js"><link rel="prefetch" href="/east-white/assets/js/124.7523b048.js"><link rel="prefetch" href="/east-white/assets/js/125.32baddcf.js"><link rel="prefetch" href="/east-white/assets/js/126.f58d8453.js"><link rel="prefetch" href="/east-white/assets/js/127.8754d2b9.js"><link rel="prefetch" href="/east-white/assets/js/128.ed017e44.js"><link rel="prefetch" href="/east-white/assets/js/129.8a96087f.js"><link rel="prefetch" href="/east-white/assets/js/13.28a7ca23.js"><link rel="prefetch" href="/east-white/assets/js/130.7351ec6e.js"><link rel="prefetch" href="/east-white/assets/js/131.718b5b67.js"><link rel="prefetch" href="/east-white/assets/js/132.fca97ffc.js"><link rel="prefetch" href="/east-white/assets/js/133.bf9ae844.js"><link rel="prefetch" href="/east-white/assets/js/134.e5e49426.js"><link rel="prefetch" href="/east-white/assets/js/135.9fe6b311.js"><link rel="prefetch" href="/east-white/assets/js/136.f81faeac.js"><link rel="prefetch" href="/east-white/assets/js/137.89d42e06.js"><link rel="prefetch" href="/east-white/assets/js/138.cfd98542.js"><link rel="prefetch" href="/east-white/assets/js/139.0df86252.js"><link rel="prefetch" href="/east-white/assets/js/14.aa2ea755.js"><link rel="prefetch" href="/east-white/assets/js/140.8766eeef.js"><link rel="prefetch" href="/east-white/assets/js/141.f8c8c45a.js"><link rel="prefetch" href="/east-white/assets/js/142.e5da7edb.js"><link rel="prefetch" href="/east-white/assets/js/143.556b2a20.js"><link rel="prefetch" href="/east-white/assets/js/144.a3789514.js"><link rel="prefetch" href="/east-white/assets/js/145.383361ee.js"><link rel="prefetch" href="/east-white/assets/js/146.304e5f90.js"><link rel="prefetch" href="/east-white/assets/js/147.93106342.js"><link rel="prefetch" href="/east-white/assets/js/148.39437afb.js"><link rel="prefetch" href="/east-white/assets/js/149.a8eb49d1.js"><link rel="prefetch" href="/east-white/assets/js/15.9dcba448.js"><link rel="prefetch" href="/east-white/assets/js/150.99725288.js"><link rel="prefetch" href="/east-white/assets/js/151.36648ce4.js"><link rel="prefetch" href="/east-white/assets/js/152.c1d051d1.js"><link rel="prefetch" href="/east-white/assets/js/153.36b0ac53.js"><link rel="prefetch" href="/east-white/assets/js/154.a0e15732.js"><link rel="prefetch" href="/east-white/assets/js/155.3b7d510c.js"><link rel="prefetch" href="/east-white/assets/js/156.3774264a.js"><link rel="prefetch" href="/east-white/assets/js/157.994faff1.js"><link rel="prefetch" href="/east-white/assets/js/158.d09f4384.js"><link rel="prefetch" href="/east-white/assets/js/159.1bbf7ffa.js"><link rel="prefetch" href="/east-white/assets/js/16.bff3f4f9.js"><link rel="prefetch" href="/east-white/assets/js/160.54091f09.js"><link rel="prefetch" href="/east-white/assets/js/161.f78ede8d.js"><link rel="prefetch" href="/east-white/assets/js/162.4edfb0dd.js"><link rel="prefetch" href="/east-white/assets/js/163.6b5ecedb.js"><link rel="prefetch" href="/east-white/assets/js/164.93663ec4.js"><link rel="prefetch" href="/east-white/assets/js/165.7d3d6224.js"><link rel="prefetch" href="/east-white/assets/js/166.480586c3.js"><link rel="prefetch" href="/east-white/assets/js/167.f391f39e.js"><link rel="prefetch" href="/east-white/assets/js/168.f616ef23.js"><link rel="prefetch" href="/east-white/assets/js/169.3ee0114e.js"><link rel="prefetch" href="/east-white/assets/js/17.3bc44ae8.js"><link rel="prefetch" href="/east-white/assets/js/170.75020e42.js"><link rel="prefetch" href="/east-white/assets/js/171.3aad072c.js"><link rel="prefetch" href="/east-white/assets/js/172.0572dbc9.js"><link rel="prefetch" href="/east-white/assets/js/173.446e9807.js"><link rel="prefetch" href="/east-white/assets/js/174.5938e6a9.js"><link rel="prefetch" href="/east-white/assets/js/175.70f6f39d.js"><link rel="prefetch" href="/east-white/assets/js/176.addb9207.js"><link rel="prefetch" href="/east-white/assets/js/177.d32546cc.js"><link rel="prefetch" href="/east-white/assets/js/178.373fd62e.js"><link rel="prefetch" href="/east-white/assets/js/179.4611766c.js"><link rel="prefetch" href="/east-white/assets/js/18.7217c230.js"><link rel="prefetch" href="/east-white/assets/js/180.96a53152.js"><link rel="prefetch" href="/east-white/assets/js/181.d1272d5d.js"><link rel="prefetch" href="/east-white/assets/js/182.0117730f.js"><link rel="prefetch" href="/east-white/assets/js/183.c053e26d.js"><link rel="prefetch" href="/east-white/assets/js/184.69d97c74.js"><link rel="prefetch" href="/east-white/assets/js/185.265792c0.js"><link rel="prefetch" href="/east-white/assets/js/186.730ac08e.js"><link rel="prefetch" href="/east-white/assets/js/187.862b3b5b.js"><link rel="prefetch" href="/east-white/assets/js/188.377e6bae.js"><link rel="prefetch" href="/east-white/assets/js/189.a35aee38.js"><link rel="prefetch" href="/east-white/assets/js/19.8f0aea91.js"><link rel="prefetch" href="/east-white/assets/js/190.ac1adb8f.js"><link rel="prefetch" href="/east-white/assets/js/191.3b423e92.js"><link rel="prefetch" href="/east-white/assets/js/192.ea2ffc5d.js"><link rel="prefetch" href="/east-white/assets/js/193.8f88d54d.js"><link rel="prefetch" href="/east-white/assets/js/194.1b6adb54.js"><link rel="prefetch" href="/east-white/assets/js/195.48d5e9cc.js"><link rel="prefetch" href="/east-white/assets/js/196.36dbf938.js"><link rel="prefetch" href="/east-white/assets/js/20.f9263f99.js"><link rel="prefetch" href="/east-white/assets/js/21.b4dd0644.js"><link rel="prefetch" href="/east-white/assets/js/22.9807b31f.js"><link rel="prefetch" href="/east-white/assets/js/23.3bab2446.js"><link rel="prefetch" href="/east-white/assets/js/24.373e85fb.js"><link rel="prefetch" href="/east-white/assets/js/25.212a3d96.js"><link rel="prefetch" href="/east-white/assets/js/26.af082478.js"><link rel="prefetch" href="/east-white/assets/js/27.84f456f8.js"><link rel="prefetch" href="/east-white/assets/js/28.49f34d1c.js"><link rel="prefetch" href="/east-white/assets/js/29.3ba03f3e.js"><link rel="prefetch" href="/east-white/assets/js/30.769fb56c.js"><link rel="prefetch" href="/east-white/assets/js/31.a6b6994f.js"><link rel="prefetch" href="/east-white/assets/js/32.fa908d36.js"><link rel="prefetch" href="/east-white/assets/js/33.689123b5.js"><link rel="prefetch" href="/east-white/assets/js/34.42fe46e8.js"><link rel="prefetch" href="/east-white/assets/js/35.430c8c19.js"><link rel="prefetch" href="/east-white/assets/js/36.1bb20e4f.js"><link rel="prefetch" href="/east-white/assets/js/37.9d2007e5.js"><link rel="prefetch" href="/east-white/assets/js/38.37058a56.js"><link rel="prefetch" href="/east-white/assets/js/39.cf329565.js"><link rel="prefetch" href="/east-white/assets/js/4.2fc4b380.js"><link rel="prefetch" href="/east-white/assets/js/40.3e3d4327.js"><link rel="prefetch" href="/east-white/assets/js/41.7aeaa974.js"><link rel="prefetch" href="/east-white/assets/js/43.67402789.js"><link rel="prefetch" href="/east-white/assets/js/44.0a198c19.js"><link rel="prefetch" href="/east-white/assets/js/45.4defb6d8.js"><link rel="prefetch" href="/east-white/assets/js/46.7f3e0779.js"><link rel="prefetch" href="/east-white/assets/js/47.020580cc.js"><link rel="prefetch" href="/east-white/assets/js/48.6b4a082c.js"><link rel="prefetch" href="/east-white/assets/js/49.4b39baf5.js"><link rel="prefetch" href="/east-white/assets/js/5.a026df5a.js"><link rel="prefetch" href="/east-white/assets/js/50.f72b3134.js"><link rel="prefetch" href="/east-white/assets/js/51.7e8e244f.js"><link rel="prefetch" href="/east-white/assets/js/52.26d293dd.js"><link rel="prefetch" href="/east-white/assets/js/53.3065c6fa.js"><link rel="prefetch" href="/east-white/assets/js/54.230bd290.js"><link rel="prefetch" href="/east-white/assets/js/55.ff844624.js"><link rel="prefetch" href="/east-white/assets/js/56.d0640c5b.js"><link rel="prefetch" href="/east-white/assets/js/57.4f07fee8.js"><link rel="prefetch" href="/east-white/assets/js/58.57e15989.js"><link rel="prefetch" href="/east-white/assets/js/59.ae0195a0.js"><link rel="prefetch" href="/east-white/assets/js/6.30fc13ff.js"><link rel="prefetch" href="/east-white/assets/js/60.5b1c572e.js"><link rel="prefetch" href="/east-white/assets/js/61.61db7a25.js"><link rel="prefetch" href="/east-white/assets/js/62.c5b337b8.js"><link rel="prefetch" href="/east-white/assets/js/63.281fd1b4.js"><link rel="prefetch" href="/east-white/assets/js/64.b4f130d6.js"><link rel="prefetch" href="/east-white/assets/js/65.953ee5f7.js"><link rel="prefetch" href="/east-white/assets/js/66.0f7ebfea.js"><link rel="prefetch" href="/east-white/assets/js/67.0d5ee134.js"><link rel="prefetch" href="/east-white/assets/js/68.07467129.js"><link rel="prefetch" href="/east-white/assets/js/69.6d6b18a4.js"><link rel="prefetch" href="/east-white/assets/js/7.93a0a8f4.js"><link rel="prefetch" href="/east-white/assets/js/70.1f81162a.js"><link rel="prefetch" href="/east-white/assets/js/71.9c22b026.js"><link rel="prefetch" href="/east-white/assets/js/72.1aead595.js"><link rel="prefetch" href="/east-white/assets/js/73.9c504f82.js"><link rel="prefetch" href="/east-white/assets/js/74.ae863fb3.js"><link rel="prefetch" href="/east-white/assets/js/75.77b22ea3.js"><link rel="prefetch" href="/east-white/assets/js/76.3fb3e486.js"><link rel="prefetch" href="/east-white/assets/js/77.aaa2bb5d.js"><link rel="prefetch" href="/east-white/assets/js/78.ff8f12c6.js"><link rel="prefetch" href="/east-white/assets/js/79.be497966.js"><link rel="prefetch" href="/east-white/assets/js/8.a5a8db2f.js"><link rel="prefetch" href="/east-white/assets/js/80.58edd302.js"><link rel="prefetch" href="/east-white/assets/js/81.d9a83954.js"><link rel="prefetch" href="/east-white/assets/js/82.ea1b1ee7.js"><link rel="prefetch" href="/east-white/assets/js/83.0480b8eb.js"><link rel="prefetch" href="/east-white/assets/js/84.b6608fc3.js"><link rel="prefetch" href="/east-white/assets/js/85.dfbc6855.js"><link rel="prefetch" href="/east-white/assets/js/86.fdf8fc7e.js"><link rel="prefetch" href="/east-white/assets/js/87.45b4397e.js"><link rel="prefetch" href="/east-white/assets/js/88.87fd2edc.js"><link rel="prefetch" href="/east-white/assets/js/89.d96587d6.js"><link rel="prefetch" href="/east-white/assets/js/9.e6aa4f2a.js"><link rel="prefetch" href="/east-white/assets/js/90.f17e0868.js"><link rel="prefetch" href="/east-white/assets/js/91.9fd183a0.js"><link rel="prefetch" href="/east-white/assets/js/92.91d6817c.js"><link rel="prefetch" href="/east-white/assets/js/93.92cd98a0.js"><link rel="prefetch" href="/east-white/assets/js/94.320bb5f5.js"><link rel="prefetch" href="/east-white/assets/js/95.11c60ecb.js"><link rel="prefetch" href="/east-white/assets/js/96.51aad249.js"><link rel="prefetch" href="/east-white/assets/js/97.b42573c1.js"><link rel="prefetch" href="/east-white/assets/js/98.d5b115f6.js"><link rel="prefetch" href="/east-white/assets/js/99.6c49b2de.js">
    <link rel="stylesheet" href="/east-white/assets/css/0.styles.8b454665.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>east-white</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>east-white's Blog</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/east-white/" class="home-link router-link-active"><img src="https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/logo.png" alt="east-white" class="logo"> <span class="site-name">east-white</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/east-white/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      FE
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/html/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/html/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>CSS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/css/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/css/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>JS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/javascript/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/javascript/advanced/" class="nav-link"><i class="undefined"></i>
  进阶
</a></li><li class="dropdown-subitem"><a href="/east-white/javascript/es6/" class="nav-link"><i class="undefined"></i>
  ECMAScript
</a></li><li class="dropdown-subitem"><a href="/east-white/javascript/ts/" class="nav-link"><i class="undefined"></i>
  TypeScript
</a></li></ul></li><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/react/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/react/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/vue/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/vue/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      App
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Flutter</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/flutter/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/flutter/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>RN</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/rn/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/rn/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>小程序</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/micro_app/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/micro_app/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>H5</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/h5/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/h5/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Server
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Go</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/go/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/go/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li><li class="dropdown-subitem"><a href="/east-white/go/advanced/" class="nav-link router-link-active"><i class="undefined"></i>
  进阶
</a></li></ul></li><li class="dropdown-item"><h4>Node</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/node/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/node/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>生态</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/server_tools/" class="nav-link"><i class="undefined"></i>
  必学
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Build
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/build/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/build/webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-subitem"><a href="/east-white/build/vite/" class="nav-link"><i class="undefined"></i>
  Vite
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Algorithms
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/data_algo/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4>数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/data_algo/data/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/data_algo/algo/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Architect
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/architect/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/architect/fe/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-subitem"><a href="/east-white/architect/server/" class="nav-link"><i class="undefined"></i>
  后端
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Life
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/life/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/life/handwriting/" class="nav-link"><i class="undefined"></i>
  书法
</a></li><li class="dropdown-subitem"><a href="/east-white/life/movies/" class="nav-link"><i class="undefined"></i>
  电影
</a></li><li class="dropdown-subitem"><a href="/east-white/life/photos/" class="nav-link"><i class="undefined"></i>
  摄影
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Library
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>资源库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/library/js/" class="nav-link"><i class="undefined"></i>
  JS
</a></li></ul></li><li class="dropdown-item"><h4>工具库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/library/design/" class="nav-link"><i class="undefined"></i>
  设计
</a></li></ul></li><li class="dropdown-item"><h4>常用信息</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/library/tools/front_end/" class="nav-link"><i class="undefined"></i>
  前端
</a></li></ul></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/ian-kevin126" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>184</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/east-white/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      FE
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/html/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/html/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>CSS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/css/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/css/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>JS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/javascript/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/javascript/advanced/" class="nav-link"><i class="undefined"></i>
  进阶
</a></li><li class="dropdown-subitem"><a href="/east-white/javascript/es6/" class="nav-link"><i class="undefined"></i>
  ECMAScript
</a></li><li class="dropdown-subitem"><a href="/east-white/javascript/ts/" class="nav-link"><i class="undefined"></i>
  TypeScript
</a></li></ul></li><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/react/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/react/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/vue/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/vue/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      App
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Flutter</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/flutter/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/flutter/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>RN</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/rn/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/rn/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>小程序</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/micro_app/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/micro_app/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>H5</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/h5/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/h5/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Server
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Go</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/go/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/go/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li><li class="dropdown-subitem"><a href="/east-white/go/advanced/" class="nav-link router-link-active"><i class="undefined"></i>
  进阶
</a></li></ul></li><li class="dropdown-item"><h4>Node</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/node/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-subitem"><a href="/east-white/node/basics/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>生态</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/server_tools/" class="nav-link"><i class="undefined"></i>
  必学
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Build
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/build/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/build/webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-subitem"><a href="/east-white/build/vite/" class="nav-link"><i class="undefined"></i>
  Vite
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Algorithms
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/data_algo/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4>数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/data_algo/data/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/data_algo/algo/" class="nav-link"><i class="undefined"></i>
  基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Architect
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/architect/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/architect/fe/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-subitem"><a href="/east-white/architect/server/" class="nav-link"><i class="undefined"></i>
  后端
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Life
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/east-white/life/source/" class="nav-link"><i class="undefined"></i>
  资源
</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/life/handwriting/" class="nav-link"><i class="undefined"></i>
  书法
</a></li><li class="dropdown-subitem"><a href="/east-white/life/movies/" class="nav-link"><i class="undefined"></i>
  电影
</a></li><li class="dropdown-subitem"><a href="/east-white/life/photos/" class="nav-link"><i class="undefined"></i>
  摄影
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Library
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>资源库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/library/js/" class="nav-link"><i class="undefined"></i>
  JS
</a></li></ul></li><li class="dropdown-item"><h4>工具库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/library/design/" class="nav-link"><i class="undefined"></i>
  设计
</a></li></ul></li><li class="dropdown-item"><h4>常用信息</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/east-white/library/tools/front_end/" class="nav-link"><i class="undefined"></i>
  前端
</a></li></ul></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/ian-kevin126" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>gRPC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/east-white/go/advanced/gRPC/1_preface/" aria-current="page" class="active sidebar-link">1、ProtoBuf</a></li><li><a href="/east-white/go/advanced/gRPC/2_proto2/" class="sidebar-link">2、proto2</a></li><li><a href="/east-white/go/advanced/gRPC/3_proto3/" class="sidebar-link">3、proto3</a></li><li><a href="/east-white/go/advanced/gRPC/4_style/" class="sidebar-link">4、风格指南</a></li><li><a href="/east-white/go/advanced/gRPC/5_code/" class="sidebar-link">5、编码</a></li><li><a href="/east-white/go/advanced/gRPC/6_techniques/" class="sidebar-link">6、技术</a></li><li><a href="/east-white/go/advanced/gRPC/8_grpc/" class="sidebar-link">8、gRPC基础实战</a></li><li><a href="/east-white/go/advanced/gRPC/9_token/" class="sidebar-link">gRPC中的Token认证</a></li><li><a href="/east-white/go/advanced/gRPC/10_grpc_tls/" class="sidebar-link">gRPC中的TLS认证</a></li><li><a href="/east-white/go/advanced/gRPC/11_middleware/" class="sidebar-link">gRPC中的截取器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>1、ProtoBuf</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">1、ProtoBuf</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="protobuf概述"><a href="#protobuf概述" class="header-anchor">#</a> ProtoBuf概述</h1> <p>协议缓冲区提供了一种语言中立、平台中立、可扩展的机制，用于以向前兼容和向后兼容的方式序列化结构化数据。它类似于 JSON，只是它更小更快，并且生成本地语言绑定。</p> <p>协议缓冲区是定义语言（在 <code>.proto</code>文件中创建）、proto 编译器生成的与数据接口的代码、特定于语言的运行时库以及写入文件（或通过网络连接）。</p> <p><code>Protobuf</code>是<code>Protocol Buffers</code>的简称，它是谷歌公司开发的一种数据描述语言，并于2008年开源。<code>Protobuf</code>刚开源时的定位类似于<code>XML、JSON</code>等数据描述语言，通过附带工具生成代码并实现将结构化数据序列化的功能。</p> <p>在序列化结构化数据的机制中，<code>ProtoBuf</code>是灵活、高效、自动化的，相对常见的<code>XML、JSON</code>，描述同样的信息，<code>ProtoBuf</code>序列化后数据量更小、序列化/反序列化速度更快、更简单。</p> <h2 id="一、协议缓冲区解决了哪些问题"><a href="#一、协议缓冲区解决了哪些问题" class="header-anchor">#</a> 一、协议缓冲区解决了哪些问题？</h2> <p>协议缓冲区为大小高达几兆字节的类型化结构化数据包提供了一种序列化格式。该格式适用于临时网络流量和长期数据存储。可以使用新信息扩展协议缓冲区，而无需使现有数据无效或需要更新代码。</p> <p>协议缓冲区是 Google 最常用的数据格式。它们广泛用于服务器间通信以及磁盘上数据的归档存储。协议缓冲区<em>消息</em>和<em>服务</em>由工程师编写的<code>.proto</code>文件描述。下面显示了一个示例<code>message</code>：</p> <div class="language-proto extra-class"><pre class="language-text"><code>message Person {
  optional string name = 1;
  optional int32 id = 2;
  optional string email = 3;
}
</code></pre></div><p>proto 编译器在<code>.proto</code>文件构建时被调用，以生成各种编程语言的代码（ 在本主题后面的<a href="https://developers.google.com/protocol-buffers/docs/overview#cross-lang" target="_blank" rel="noopener noreferrer">跨语言兼容性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中介绍）来操作相应的协议缓冲区。每个生成的类都包含每个字段的简单访问器和方法，用于序列化和解析整个结构与原始字节之间的关系。下面向您展示了一个使用这些生成方法的示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Person</span> john <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;jdoe@example.com&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
john<span class="token punctuation">.</span><span class="token function">writeTo</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于协议缓冲区在 Google 的各种服务中广泛使用，并且其中的数据可能会保留一段时间，因此保持向后兼容性至关重要。协议缓冲区允许无缝支持对任何协议缓冲区的更改，包括添加新字段和删除现有字段，而不会破坏现有服务。有关此主题的更多信息，请参阅本主题后面的在<a href="https://developers.google.com/protocol-buffers/docs/overview#updating-defs" target="_blank" rel="noopener noreferrer">不更新代码的情况下更新原型定义。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="二、使用协议缓冲区有什么好处"><a href="#二、使用协议缓冲区有什么好处" class="header-anchor">#</a> 二、使用协议缓冲区有什么好处？</h2> <p>协议缓冲区非常适合任何需要以语言中立、平台中立、可扩展的方式序列化结构化、类似记录、类型化数据的情况。它们最常用于定义通信协议（与 gRPC 一起）和数据存储。</p> <p>使用协议缓冲区的一些优点包括：</p> <ul><li>紧凑的数据存储</li> <li>快速解析</li> <li>许多编程语言的可用性</li> <li>通过自动生成的类优化功能</li></ul> <h3 id="_1、跨语言兼容性"><a href="#_1、跨语言兼容性" class="header-anchor">#</a> 1、跨语言兼容性</h3> <p>以任何受支持的编程语言编写的代码都可以读取相同的消息。您可以让一个平台上的 Java 程序从一个软件系统捕获数据，根据<code>.proto</code>定义对其进行序列化，然后在另一个平台上运行的单独 Python 应用程序中从序列化数据中提取特定值。</p> <p>协议缓冲区编译器 protoc 直接支持以下语言：</p> <ul><li><a href="https://developers.google.com/protocol-buffers/docs/reference/cpp-generated#invocation" target="_blank" rel="noopener noreferrer">C++<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/csharp-generated#invocation" target="_blank" rel="noopener noreferrer">C＃<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/java-generated#invocation" target="_blank" rel="noopener noreferrer">Java<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/kotlin-generated#invocation" target="_blank" rel="noopener noreferrer">Kotlin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/objective-c-generated#invocation" target="_blank" rel="noopener noreferrer">Objective-C<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/php-generated#invocation" target="_blank" rel="noopener noreferrer">PHP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/python-generated#invocation" target="_blank" rel="noopener noreferrer">Python<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/protocol-buffers/docs/reference/ruby-generated#invocation" target="_blank" rel="noopener noreferrer">Ruby<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Google 支持以下语言，但项目的源代码位于 GitHub 存储库中。protoc 编译器使用这些语言的插件：</p> <ul><li><a href="https://github.com/google/protobuf.dart" target="_blank" rel="noopener noreferrer">Dart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/protocolbuffers/protobuf-go" target="_blank" rel="noopener noreferrer">Go<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>其他语言不直接由 Google 支持，而是由其他 GitHub 项目支持。这些语言包含在<a href="https://github.com/protocolbuffers/protobuf/blob/master/docs/third_party.md" target="_blank" rel="noopener noreferrer">Protocol Buffers 的第三方插件中<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="_2、跨项目支持"><a href="#_2、跨项目支持" class="header-anchor">#</a> 2、跨项目支持</h3> <p>您可以通过在驻留在特定项目代码库之外的文件中定义<code>message</code>类型来 跨项目使用协议缓冲区。<code>.proto</code>如果您正在定义<code>message</code>您预计将在您的直接团队之外广泛使用的类型或枚举，您可以将它们放在自己的文件中而没有依赖关系。</p> <p>在 Google 中广泛使用的几个原型定义示例是 <a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/timestamp.proto" target="_blank" rel="noopener noreferrer"><code>timestamp.proto</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto" target="_blank" rel="noopener noreferrer"><code>status.proto</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="_3、在不更新代码的情况下更新原型定义"><a href="#_3、在不更新代码的情况下更新原型定义" class="header-anchor">#</a> 3、在不更新代码的情况下更新原型定义</h3> <p>软件产品向后兼容是标准，但向前兼容却不太常见。只要您 在更新定义时遵循一些<a href="https://developers.google.com/protocol-buffers/docs/proto#updating" target="_blank" rel="noopener noreferrer">简单的做法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><code>.proto</code> ，旧代码将毫无问题地读取新消息，而忽略任何新添加的字段。对于旧代码，删除的字段将具有默认值，删除的重复字段将为空。有关什么是“重复”字段的信息，请参阅本主题后面的<a href="https://developers.google.com/protocol-buffers/docs/overview#syntax" target="_blank" rel="noopener noreferrer">协议缓冲区定义语法。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>新代码也将透明地读取旧消息。旧消息中不会出现新字段；在这些情况下，协议缓冲区提供了一个合理的默认值。</p> <h3 id="_4、什么时候协议缓冲区不适合"><a href="#_4、什么时候协议缓冲区不适合" class="header-anchor">#</a> 4、什么时候协议缓冲区不适合？</h3> <p>协议缓冲区并不适合所有数据。尤其：</p> <ul><li>协议缓冲区倾向于假设整个消息可以一次加载到内存中并且不大于对象图。对于超过几兆字节的数据，考虑不同的解决方案；在处理较大的数据时，由于序列化副本，您可能会有效地获得多个数据副本，这可能会导致内存使用量出现惊人的峰值。</li> <li>当协议缓冲区被序列化时，相同的数据可以有许多不同的二进制序列化。如果不完全解析它们，就无法比较两条消息的相等性。</li> <li>消息未压缩。虽然消息可以像任何其他文件一样被压缩或 gzip 压缩，但专用压缩算法（如 JPEG 和 PNG 使用的压缩算法）将为适当类型的数据生成小得多的文件。</li> <li>对于涉及大型多维浮点数数组的许多科学和工程用途，协议缓冲区消息在大小和速度方面都没有达到最大效率。对于这些应用程序， <a href="https://en.wikipedia.org/wiki/FITS" target="_blank" rel="noopener noreferrer">FITS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和类似格式的开销较小。</li> <li>协议缓冲区在科学计算中流行的非面向对象语言（例如 Fortran 和 IDL）中没有得到很好的支持。</li> <li>协议缓冲区消息本身并不自我描述其数据，但它们具有完全反射的模式，您可以使用它来实现自我描述。也就是说，如果不访问其相应的<code>.proto</code>文件，您将无法完全解释它。</li> <li>协议缓冲区不是任何组织的正式标准。这使得它们不适合在具有法律或其他要求以建立在标准之上的环境中使用。</li></ul> <h3 id="_5、xml、json、protobuf对比"><a href="#_5、xml、json、protobuf对比" class="header-anchor">#</a> 5、XML、JSON、Protobuf对比</h3> <ul><li><code>json</code>: 一般的<code>web</code>项目中，最流行的主要还是<code>json</code>。因为浏览器对于<code>json</code>数据支持非常好，有很多内建的函数支持。</li> <li><code>xml</code>: 在<code>webservice</code>中应用最为广泛，但是相比于<code>json</code>，它的数据更加冗余，因为需要成对的闭合标签。<code>json</code>使用了键值对的方式，不仅压缩了一定的数据空间，同时也具有可读性。</li> <li><code>protobuf</code>:是后起之秀，是谷歌开源的一种数据格式，适合高性能，对响应速度有要求的数据传输场景。因为<code>profobuf</code>是二进制数据格式，需要编码和解码。数据本身不具有可读性。因此只能反序列化之后得到真正可读的数据。</li></ul> <table><thead><tr><th></th> <th>XML</th> <th>JSON</th> <th>Protocol Buffers</th></tr></thead> <tbody><tr><td>数据保存方式</td> <td>文本</td> <td>文本</td> <td>二进制</td></tr> <tr><td>可读性</td> <td>较好</td> <td>较好</td> <td>不可读</td></tr> <tr><td>解析速度</td> <td>慢</td> <td>一般</td> <td>快</td></tr> <tr><td>语言支持</td> <td>所有语言</td> <td>所有语言</td> <td>所有语言</td></tr> <tr><td>使用范围</td> <td>文件存储、数据交互</td> <td>文件存储、数据交互</td> <td>文件存储、数据交互</td></tr></tbody></table> <h2 id="三、谁使用协议缓冲区"><a href="#三、谁使用协议缓冲区" class="header-anchor">#</a> 三、谁使用协议缓冲区？</h2> <p>许多外部可用的项目使用协议缓冲区，包括以下内容：</p> <ul><li><a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cloud.google.com/" target="_blank" rel="noopener noreferrer">谷歌云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.envoyproxy.io/" target="_blank" rel="noopener noreferrer">特使代理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="四、协议缓冲区如何工作"><a href="#四、协议缓冲区如何工作" class="header-anchor">#</a> 四、协议缓冲区如何工作？</h2> <p>下图显示了如何使用协议缓冲区来处理数据。</p> <p><img src="https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/protocol-buffers-concepts.png" alt="img"></p> <p><strong>图 1. 协议缓冲区工作流程</strong></p> <p>协议缓冲区生成的代码提供了从文件和流中检索数据、从数据中提取单个值、检查数据是否存在、将数据序列化回文件或流以及其他有用功能的实用方法。</p> <p>以下代码示例向您展示了 Java 中此流程的示例。如前所述，这是一个<code>.proto</code>定义：</p> <div class="language-go extra-class"><pre class="language-go"><code>message Person <span class="token punctuation">{</span>
  optional <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  optional <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  optional <span class="token builtin">string</span> email <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编译此<code>.proto</code>文件会创建一个<code>Builder</code>类，您可以使用它来创建新实例，如以下 Java 代码所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Person</span> john <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;jdoe@example.com&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
john<span class="token punctuation">.</span><span class="token function">writeTo</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后，您可以使用 protocol buffers 在其他语言（如 C++）中创建的方法反序列化数据：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>Person john<span class="token punctuation">;</span>
fstream <span class="token function">input</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>in <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
john<span class="token punctuation">.</span><span class="token function">ParseFromIstream</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> id <span class="token operator">=</span> john<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string name <span class="token operator">=</span> john<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string email <span class="token operator">=</span> john<span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="五、协议缓冲区定义语法"><a href="#五、协议缓冲区定义语法" class="header-anchor">#</a> 五、协议缓冲区定义语法</h2> <p>定义<code>.proto</code>文件时，您可以指定字段为<code>optional</code> or <code>repeated</code>(proto2 and proto3) or <code>singular</code>(proto3)。（将字段设置为的选项<code>required</code>在 proto3 中不存在，并且在 proto2 中强烈建议不要使用。有关此内容的更多信息，请参阅“<a href="https://developers.google.com/protocol-buffers/docs/proto#specifying-rules" target="_blank" rel="noopener noreferrer">指定字段规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>”中的“必填项” 。）</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 指明当前使用proto3语法，如果不指定，编译器会使用proto2</span>
syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// package声明符，用来防止消息类型有命名冲突</span>
<span class="token keyword">package</span> msg<span class="token punctuation">;</span>
<span class="token comment">// 选项信息，对应go的包路径</span>
option go_package <span class="token operator">=</span> <span class="token string">&quot;server/msg&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// message关键字，像go中的结构体</span>
message FirstMsg <span class="token punctuation">{</span>
  <span class="token comment">// 类型 字段名 标识号</span>
  <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> name<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> age<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>syntax</code>: 用来标记当前使用<code>proto</code>的哪个版本。</li> <li><code>package</code>: 包名，用来防止消息类型命名冲突。</li> <li><code>option go_package</code>: 选项信息，代表生成后的<code>go</code>代码包路径。</li> <li><code>message</code>: 声明消息的关键字，类似<code>Go</code>语言中的<code>struct</code>。</li> <li>定义字段语法: <code>类型 字段名 标识号</code></li></ul> <blockquote><p><strong>标识号说明</strong></p> <ul><li>每个字段都有唯一的一个数字标识符，一旦开始使用就不能够再改变。</li> <li><strong>[1, 15]之内的标识号在编码的时候会占用一个字节。[16, 2047]之内的标识号则占用2个字节。</strong></li> <li><strong>最小的标识号可以从1开始，最大到2^29 - 1, or 536,870,911。不可以使用其中的[19000－19999],因为是预留信息，如果使用，编译时会报警。</strong></li></ul></blockquote> <p>设置字段的可选性/可重复性后，指定数据类型。协议缓冲区支持通常的原始数据类型，例如整数、布尔值和浮点数。有关完整列表，请参阅 <a href="https://developers.google.com/protocol-buffers/docs/proto#scalar" target="_blank" rel="noopener noreferrer">标量值类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>一个字段也可以是：</p> <ul><li>一种<code>message</code>类型，以便您可以嵌套部分定义，例如用于重复数据集。</li> <li>一种<code>enum</code>类型，因此您可以指定一组值以供选择。</li> <li>一种<code>oneof</code>类型，当消息有许多可选字段并且最多同时设置一个字段时可以使用该类型。</li> <li>一种<code>map</code>类型，用于将键值对添加到您的定义中。</li></ul> <p>在 proto2 中，消息可以允许<strong>扩展</strong>定义消息本身之外的字段。例如，protobuf 库的内部消息模式允许扩展自定义的、特定于使用的选项。</p> <p>有关可用选项的更多信息，请参阅 <a href="https://developers.google.com/protocol-buffers/docs/proto" target="_blank" rel="noopener noreferrer">proto2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或 <a href="https://developers.google.com/protocol-buffers/docs/proto3" target="_blank" rel="noopener noreferrer">proto3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的语言指南。</p> <p>在设置可选性和字段类型后，您分配一个字段编号。字段编号不能改变用途或重复使用。如果您删除一个字段，您应该保留其字段编号，以防止有人意外重复使用该编号。</p> <h3 id="_1、简单类型与go对应"><a href="#_1、简单类型与go对应" class="header-anchor">#</a> 1、简单类型与Go对应</h3> <table><thead><tr><th>.proto</th> <th>Go</th> <th>Notes</th></tr></thead> <tbody><tr><td>double</td> <td>float64</td> <td></td></tr> <tr><td>float</td> <td>float32</td> <td></td></tr> <tr><td>int32</td> <td>int32</td> <td>对于负值的效率很低，如果有负值,使用sint64</td></tr> <tr><td>uint32</td> <td>uint32</td> <td>使用变长编码</td></tr> <tr><td>uint64</td> <td>uint64</td> <td>使用变长编码</td></tr> <tr><td>sint32</td> <td>int32</td> <td>负值时比int32高效的多</td></tr> <tr><td>sint64</td> <td>int64</td> <td>使用变长编码，有符号的整型值。编码时比通常的int64高效。</td></tr> <tr><td>fixed32</td> <td>uint32</td> <td>总是4个字节，如果数值总是比总是比228大的话，这个类型会比uint32高效。</td></tr> <tr><td>fixed64</td> <td>uint64</td> <td>是8个字节，如果数值总是比总是比256大的话，这个类型会比uint64高效。</td></tr></tbody></table> <h4 id="默认值"><a href="#默认值" class="header-anchor">#</a> 默认值</h4> <ul><li>对于strings, 默认值是空字符串(注, 是&quot;&quot;, 而不是null)</li> <li>对于bytes, 默认值是空字节(注, 应该是byte[0], 注意这里也不是null)</li> <li>对于boolean, 默认值是false.</li> <li>对于数字类型, 默认值是0.</li> <li>对于枚举, 默认值是第一个定义的枚举值, 而这个值必须是0.</li> <li>对于消息字段, 默认值是null.</li></ul> <p>对于重复字段, 默认值是空(通常都是空列表)</p> <blockquote><p>注意: 对于简单字段, 当消息被解析后, 如果值恰巧和默认值相同(例如一个boolean设置为false)是没有办法知道这个字段到底是有设置值还是取了默认值。这样就要求，不要根据默认值来采取某些切换行为，例如当某个 boolean 值为false时，切换状态。同样的，如果一个字段被设置了默认值，这个值不会被序列化。</p></blockquote> <h3 id="_2、保留标识符-reserved"><a href="#_2、保留标识符-reserved" class="header-anchor">#</a> 2、保留标识符(<code>reserved</code>)</h3> <blockquote><p>什么是保留标示符？<strong>reserved 标记的标识号、字段名，都不能在当前消息中使用。</strong></p></blockquote> <div class="language-go extra-class"><pre class="language-go"><code>message Foo <span class="token punctuation">{</span>
  reserved <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span> to <span class="token number">11</span><span class="token punctuation">;</span>
  reserved <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在更新message type时，假设需要彻底删除一个field，或者注释掉，这样未来其他人就可以继续使用之前分配给这个字段的编号。如果他们以后加载了相同 <code>.proto</code> 文件的旧版本，这可能会导致严重问题，包括数据损坏，隐私错误等。有一个办法就是将要删除的字段设置为保留字段，未来任何用户试图使用这个字段的时候，protocol buffer 的编译器就会告警提示。</p> <p>但是要注意不能在同一个保留字段声明中混合使用数字和 Field name.</p> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">package</span> demo<span class="token punctuation">;</span>

<span class="token comment">// 在这个消息中标记</span>
message DemoMsg <span class="token punctuation">{</span>
  <span class="token comment">// 标示号：1，2，10，11，12，13 都不能用</span>
  reserved <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span> to <span class="token number">13</span><span class="token punctuation">;</span>
  <span class="token comment">// 字段名 test、name 不能用</span>
  reserved <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 不能使用字段名，提示:Field name 'name' is reserved</span>
  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token comment">// 不能使用标示号,提示:Field 'id' uses reserved number 11</span>
  <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 另外一个消息还是可以正常使用</span>
message Demo2Msg <span class="token punctuation">{</span>
  <span class="token comment">// 标示号可以正常使用</span>
  <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// 字段名可以正常使用</span>
  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3、枚举类型"><a href="#_3、枚举类型" class="header-anchor">#</a> 3、枚举类型</h3> <p>当定义消息类型时, 我们希望某个字段只能有预先定义的多个值中的一个. 例如, 为每个SearchRequest添加一个corpus字段, 而corpus可以是UNIVERSAL, WEB, IMAGES, LOCAL, NEWS, PRODUCTS 或 VIDEO . 这样就可以简单的添加一个枚举到消息定义, 为每个可能的值定义常量。</p> <div class="language-go extra-class"><pre class="language-go"><code>message SearchRequest <span class="token punctuation">{</span>
  <span class="token builtin">string</span> query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  enum Corpus <span class="token punctuation">{</span>
    UNIVERSAL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    WEB <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    IMAGES <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    LOCAL <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    NEWS <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    PRODUCTS <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    VIDEO <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Corpus corpus <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>举的第一个常量设置到0: 每个枚举定义必须包含一个映射到0的常量作为它的第一个元素. 这是因为:</p> <ul><li>必须有一个0值, 这样我们才能用0来作为数值默认值</li> <li>0值必须是第一个元素, 兼容proto2语法,在proto2中默认值总是第一个枚举值</li></ul> <p>可以通过将相同值赋值给不同的枚举常量来定义别名. 为此需要设置allow_alias选项为true,否则protocol编译器会报错。</p> <div class="language-go extra-class"><pre class="language-go"><code>enum EnumAllowingAlias <span class="token punctuation">{</span>
  option allow_alias <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  UNKNOWN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  STARTED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  RUNNING <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
enum EnumNotAllowingAlias <span class="token punctuation">{</span>
  UNKNOWN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  STARTED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// RUNNING = 1;  // Uncommenting this line will cause a compile error inside Google and a warning message outside.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>枚举常量必须在32位整形的范围内. 由于枚举值使用 <code>varint encoding</code>, 负值是效率低下的因此不推荐使用。</p> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">package</span> demo<span class="token punctuation">;</span>
<span class="token comment">// 声明生成Go代码，包路径</span>
option go_package <span class="token operator">=</span><span class="token string">&quot;server/demo&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 枚举消息</span>
message DemoEnumMsg <span class="token punctuation">{</span>
  enum Gender<span class="token punctuation">{</span>
    <span class="token comment">// 枚举字段标识符,必须从0开始</span>
    UnKnown <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    Body <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    Girl <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 使用自定义的枚举类型</span>
  Gender sex <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在枚举信息中，重复使用标识符</span>
message DemoTwoMsg<span class="token punctuation">{</span>
  enum Animal <span class="token punctuation">{</span>
    <span class="token comment">// 开启允许重复使用 标示符</span>
    option allow_alias <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    Other <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    Cat <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    Dog <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">// 白猫也是毛，标示符也用1</span>
    <span class="token comment">// 不开启allow_alias，会报错： Enum value number 1 has already been used by value 'Cat'</span>
    WhiteCat <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>每个枚举类型必须将其第一个类型映射为0, 原因有两个：1.必须有个默认值为0； 2.为了兼容proto2语法，枚举类的第一个值总是默认值.</strong></p></blockquote> <h3 id="_4、嵌套消息"><a href="#_4、嵌套消息" class="header-anchor">#</a> 4、嵌套消息</h3> <p>与其他编程语言一样，Protocol Buffer 支持内嵌类型，并且可以内嵌多层。</p> <div class="language-go extra-class"><pre class="language-go"><code>message SearchResponse <span class="token punctuation">{</span>
  message Result <span class="token punctuation">{</span>
    <span class="token builtin">string</span> url <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> title <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    repeated <span class="token builtin">string</span> snippets <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  repeated Result result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果想在父消息类型之外重用消息类型, 可以使用 Parent.Type 来引用:</p> <div class="language-go extra-class"><pre class="language-go"><code>message SomeOtherMessage <span class="token punctuation">{</span>
  SearchResponse<span class="token punctuation">.</span>Result result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面是一个完整的实例：</p> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
option go_package <span class="token operator">=</span> <span class="token string">&quot;server/nested&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 学员信息</span>
message UserInfo <span class="token punctuation">{</span>
  <span class="token builtin">int32</span> userId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> userName <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
message Common <span class="token punctuation">{</span>
  <span class="token comment">// 班级信息</span>
  message CLassInfo<span class="token punctuation">{</span>
    <span class="token builtin">int32</span> classId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> className <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 嵌套信息</span>
message NestedDemoMsg <span class="token punctuation">{</span>
  <span class="token comment">// 学员信息 (直接使用消息类型)</span>
  UserInfo userInfo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// 班级信息 (通过Parent.Type，调某个消息类型的子类型)</span>
  Common<span class="token punctuation">.</span>CLassInfo classInfo <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>还可以嵌套更深：</p> <div class="language-go extra-class"><pre class="language-go"><code>message Outer <span class="token punctuation">{</span>                  <span class="token comment">// Level 0</span>
  message MiddleAA <span class="token punctuation">{</span>  <span class="token comment">// Level 1</span>
    message Inner <span class="token punctuation">{</span>   <span class="token comment">// Level 2</span>
      <span class="token builtin">int64</span> ival <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token builtin">bool</span>  booly <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  message MiddleBB <span class="token punctuation">{</span>  <span class="token comment">// Level 1</span>
    message Inner <span class="token punctuation">{</span>   <span class="token comment">// Level 2</span>
      <span class="token builtin">int32</span> ival <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token builtin">bool</span>  booly <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="更新消息类型"><a href="#更新消息类型" class="header-anchor">#</a> 更新消息类型</h4> <p>如果现有的消息类型不再满足所有需求 (例如，添加额外的字段 )，但仍然希望使用使用旧格式创建的代码，不用担心，在不破坏任何现有代码的情况下更新消息类型非常简单。请记住以下规则：</p> <ul><li><strong>不要</strong>更改任何现有字段的字段编号；</li> <li>如果添加新的字段时, 使用&quot;老&quot;消息格式序列化后的任何消息都可以被新生成的代码解析. 但是需要留意这些元素的默认值以便新的代码可以正确和老代码生成的消息交互(也就是说，新添加的字段此时会采用默认值，因为lao的消息传递过来的时候不会包含这些字段). 类似的, 新代码创建的消息可以被老代码解析: 解析时新的字段被简单的忽略. 当消息反序列化时未知字段会失效, 因此如果消息被传递给新代码, 新的字段将不再存在.</li> <li>字段可以被删除, 但是要求在更新后的消息类型中原来的标签数字不再使用.可以考虑重命名这个字段, 或者添加前缀<code>OBSOLETE_</code>, 或者<code>reserved</code>, 以便其他用户在修改.proto文件不会不小心重用这个数字.</li> <li><code>int32</code>, <code>uint32</code>, <code>int64</code>, <code>uint64</code>, 和 <code>bool</code> 是完全兼容的 ,也就是说可以将一个字段的类型从这些类型中的一个修改为另外一个，而不会打破向前或者向后兼容. 也就是说，类型解析时会做一下相应的类型转换。</li> <li>sint32 和 sint64 是彼此兼容的,但是和其他整型类型不兼容.</li> <li>string 和 bytes 是兼容的, 如果bytes是有效的UTF-8编码的.</li> <li>如果bytes包含这个消息编码后的内容，内嵌的message type 和bytes兼容,.</li> <li>fixed32 兼容 sfixed32, 而 fixed64 兼容 sfixed64.</li></ul> <h3 id="_5、map类型消息"><a href="#_5、map类型消息" class="header-anchor">#</a> 5、map类型消息</h3> <p>如果想创建一个map作为数据定义的一部分, 可以使用下面的语法:</p> <blockquote><p>map map_field = N;</p></blockquote> <p>key_type可以是任意整型或者字符类型( 除了floating point和bytes外任何简单类型). value_type可以是任意类型.</p> <p>这与大多数编程语言类似,例如下面的代码，projects 是另一个 message type。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">map</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Project<span class="token operator">&gt;</span> projects <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>map语法和下面的代码等同</strong></p> <div class="language-go extra-class"><pre class="language-go"><code>message MapFieldEntry <span class="token punctuation">{</span>
  key_type key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  value_type value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

repeated MapFieldEntry map_field <span class="token operator">=</span> N<span class="token punctuation">;</span>
</code></pre></div><h4 id="_5-1-protobuf源码"><a href="#_5-1-protobuf源码" class="header-anchor">#</a> 5.1 <code>protobuf</code>源码</h4> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
option go_package <span class="token operator">=</span> <span class="token string">&quot;server/demo&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// map消息</span>
message DemoMapMsg <span class="token punctuation">{</span>
  <span class="token builtin">int32</span> userId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">map</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token operator">&gt;</span> like <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-2-生成go代码"><a href="#_5-2-生成go代码" class="header-anchor">#</a> 5.2 生成<code>Go</code>代码</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// map消息</span>
<span class="token keyword">type</span> DemoMapMsg <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	state         protoimpl<span class="token punctuation">.</span>MessageState
	sizeCache     protoimpl<span class="token punctuation">.</span>SizeCache
	unknownFields protoimpl<span class="token punctuation">.</span>UnknownFields

	UserId <span class="token builtin">int32</span>             <span class="token string">`protobuf:&quot;varint,1,opt,name=userId,proto3&quot; json:&quot;userId,omitempty&quot;`</span>
	Like   <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`protobuf:&quot;bytes,2,rep,name=like,proto3&quot; json:&quot;like,omitempty&quot; protobuf_key:&quot;bytes,1,opt,name=key,proto3&quot; protobuf_val:&quot;bytes,2,opt,name=value,proto3&quot;`</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6、切片-数组-类型消息"><a href="#_6、切片-数组-类型消息" class="header-anchor">#</a> 6、切片(数组)类型消息</h3> <h4 id="_6-1-protobuf源码"><a href="#_6-1-protobuf源码" class="header-anchor">#</a> 6.1 <code>protobuf</code>源码</h4> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
option go_package <span class="token operator">=</span> <span class="token string">&quot;server/demo&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// repeated允许字段重复，对于Go语言来说，它会编译成数组(slice of type)类型的格式</span>
message DemoSliceMsg <span class="token punctuation">{</span>
  <span class="token comment">// 会生成 []int32</span>
  repeated <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// 会生成 []string</span>
  repeated <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token comment">// 会生成 []float32</span>
  repeated float price <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token comment">// 会生成 []float64</span>
  repeated double money <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-2-生成go代码"><a href="#_6-2-生成go代码" class="header-anchor">#</a> 6.2 生成<code>Go</code>代码</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token comment">// repeated允许字段重复，对于Go语言来说，它会编译成数组(slice of type)类型的格式</span>
<span class="token keyword">type</span> DemoSliceMsg <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	state         protoimpl<span class="token punctuation">.</span>MessageState
	sizeCache     protoimpl<span class="token punctuation">.</span>SizeCache
	unknownFields protoimpl<span class="token punctuation">.</span>UnknownFields

	<span class="token comment">// 会生成 []int32</span>
	Id <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int32</span> <span class="token string">`protobuf:&quot;varint,1,rep,packed,name=id,proto3&quot; json:&quot;id,omitempty&quot;`</span>
	<span class="token comment">// 会生成 []string</span>
	Name <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`protobuf:&quot;bytes,2,rep,name=name,proto3&quot; json:&quot;name,omitempty&quot;`</span>
	<span class="token comment">// 会生成 []float32</span>
	Price <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span> <span class="token string">`protobuf:&quot;fixed32,3,rep,packed,name=price,proto3&quot; json:&quot;price,omitempty&quot;`</span>
	Money <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span> <span class="token string">`protobuf:&quot;fixed64,4,rep,packed,name=money,proto3&quot; json:&quot;money,omitempty&quot;`</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><h3 id="_7、引入其他proto文件"><a href="#_7、引入其他proto文件" class="header-anchor">#</a> 7、引入其他<code>proto</code>文件</h3> <h4 id="_7-1-被引入文件class-proto"><a href="#_7-1-被引入文件class-proto" class="header-anchor">#</a> 7.1 被引入文件<code>class.proto</code></h4> <p><strong>文件位置:<code>proto/class.proto</code></strong></p> <div class="language-go extra-class"><pre class="language-go"><code>syntax<span class="token operator">=</span><span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 包名</span>
<span class="token keyword">package</span> dto<span class="token punctuation">;</span>
<span class="token comment">// 生成go后的文件路径</span>
option go_package <span class="token operator">=</span> <span class="token string">&quot;grpc/server/dto&quot;</span><span class="token punctuation">;</span>

message ClassMsg <span class="token punctuation">{</span>
  <span class="token builtin">int32</span>  classId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> className <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_7-2-使用引入文件user-proto"><a href="#_7-2-使用引入文件user-proto" class="header-anchor">#</a> 7.2 使用引入文件<code>user.proto</code></h4> <p><strong>文件位置:<code>proto/user.proto</code></strong></p> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 导入其他proto文件</span>
<span class="token keyword">import</span> <span class="token string">&quot;proto/class.proto&quot;</span><span class="token punctuation">;</span>

option go_package<span class="token operator">=</span><span class="token string">&quot;grpc/server/dto&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">package</span> dto<span class="token punctuation">;</span>

<span class="token comment">// 用户信息</span>
message UserDetail<span class="token punctuation">{</span>
  <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> address <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  repeated <span class="token builtin">string</span> likes <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token comment">// 所属班级</span>
  ClassMsg classInfo <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8、import-proto"><a href="#_8、import-proto" class="header-anchor">#</a> 8、import proto</h3> <p>像编写代码一样,proto文件也支持从其他的proto文件中导入message 定义。</p> <blockquote><p>import &quot;myproject/other_protos.proto&quot;;</p></blockquote> <p><strong>但是这里要注意</strong></p> <p>假设 <code>a.proto</code>引入了<code>b.proto</code>，但是<code>b.proto</code>更换了位置，路径变成了<code>test/b.proto</code>,那有下面的办法可以解决:</p> <ul><li>修改<code>a.proto</code>中的import语句，直接<code>import &quot;test/b.proto&quot;</code></li> <li>在<code>b.proto</code>文件原来的位置，创建一个<code>b.proto</code>文件，文件内容为<code>import public &quot;test/b.proto&quot;</code>，就可以了</li></ul> <p>假设 <code>a.proto</code>引入了<code>b.proto</code>，<code>b.proto</code> 中引用 <code>c.proto</code>,如果 <code>a.proto</code>想要引用<code>c.proto</code>，是不能直接用的，同样有下面两种办法：</p> <ul><li>在<code>a.proto</code>中新增<code>c.proto</code>的引用</li> <li>在<code>b.proto</code>中将引用修改为 `import public &quot;c.proto&quot;``</li></ul> <h2 id="六、定义服务-service"><a href="#六、定义服务-service" class="header-anchor">#</a> 六、定义服务(<code>Service</code>)</h2> <blockquote><p>上面学习的都是怎么定义一个消息类型，如果想要将消息类型用在RPC(远程方法调用)系统中，需要使用关键字(<code>service</code>)定义一个RPC服务接口，使用<code>rpc</code>定义具体方法，而消息类型则充当方法的参数和返回值。</p></blockquote> <h3 id="_1、编写service"><a href="#_1、编写service" class="header-anchor">#</a> 1、编写<code>service</code></h3> <p><strong>文件位置:<code>proto/hello_service.proto</code></strong></p> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

option go_package <span class="token operator">=</span> <span class="token string">&quot;grpc/server&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 定义入参消息</span>
message HelloParam<span class="token punctuation">{</span>
  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> context <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义出参消息</span>
message HelloResult <span class="token punctuation">{</span>
  <span class="token builtin">string</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义service</span>
service HelloService<span class="token punctuation">{</span>
  <span class="token comment">// 定义方法 </span>
  rpc <span class="token function">SayHello</span><span class="token punctuation">(</span>HelloParam<span class="token punctuation">)</span> returns <span class="token punctuation">(</span>HelloResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2、生成go代码"><a href="#_2、生成go代码" class="header-anchor">#</a> 2、生成<code>Go</code>代码</h3> <blockquote><p>使用命令:**<code>protoc --go_out=. --go-grpc_out=. proto/hello_service.proto</code>**生成代码。</p></blockquote> <p>上述命令会生成很多代码,我们的工作主要是要实现<code>SayHello</code>方法,下面是生成的部分代码。</p> <h4 id="_2-1-客户端部分代码"><a href="#_2-1-客户端部分代码" class="header-anchor">#</a> 2.1 客户端部分代码</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 客户端接口</span>
<span class="token keyword">type</span> HelloServiceClient <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> in <span class="token operator">*</span>HelloParam<span class="token punctuation">,</span> opts <span class="token operator">...</span>grpc<span class="token punctuation">.</span>CallOption<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 客户端实现调用SayHello方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>helloServiceClient<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> in <span class="token operator">*</span>HelloParam<span class="token punctuation">,</span> opts <span class="token operator">...</span>grpc<span class="token punctuation">.</span>CallOption<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	out <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>HelloResult<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> c<span class="token punctuation">.</span>cc<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;/HelloService/SayHello&quot;</span><span class="token punctuation">,</span> in<span class="token punctuation">,</span> out<span class="token punctuation">,</span> opts<span class="token operator">...</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> out<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-2-服务端部分代码"><a href="#_2-2-服务端部分代码" class="header-anchor">#</a> 2.2 服务端部分代码</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 生成的接口</span>
<span class="token keyword">type</span> HelloServiceServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">SayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>HelloParam<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">mustEmbedUnimplementedHelloServiceServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 需要实现SayHello方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>UnimplementedHelloServiceServer<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>HelloParam<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> status<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>codes<span class="token punctuation">.</span>Unimplemented<span class="token punctuation">,</span> <span class="token string">&quot;method SayHello not implemented&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-3-实现服务端-sayhello-方法"><a href="#_2-3-实现服务端-sayhello-方法" class="header-anchor">#</a> 2.3 实现服务端(<code>SayHello</code>)方法</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>UnimplementedHelloServiceServer<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> p <span class="token operator">*</span>HelloParam<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//return nil, status.Errorf(codes.Unimplemented, &quot;method SayHello not implemented&quot;)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>HelloResult<span class="token punctuation">{</span>Result<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s say %s&quot;</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">GetContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3、运行服务"><a href="#_3、运行服务" class="header-anchor">#</a> 3、运行服务</h3> <h4 id="_3-1-编写服务端"><a href="#_3-1-编写服务端" class="header-anchor">#</a> 3.1 编写服务端</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;52lu/go-rpc/grpc/server&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;google.golang.org/grpc&quot;</span>
	<span class="token string">&quot;net&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// 服务端代码</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 创建grpc服务</span>
	rpcServer <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 注册服务</span>
	server<span class="token punctuation">.</span><span class="token function">RegisterHelloServiceServer</span><span class="token punctuation">(</span>rpcServer<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>UnimplementedHelloServiceServer<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 监听端口</span>
	listen<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:1234&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;服务启动失败&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;服务启动成功!&quot;</span><span class="token punctuation">)</span>
	rpcServer<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>listen<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-2-编写客户端"><a href="#_3-2-编写客户端" class="header-anchor">#</a> 3.2 编写客户端</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;52lu/go-rpc/grpc/server&quot;</span>
	<span class="token string">&quot;context&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;google.golang.org/grpc&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 客户端代码</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 建立链接</span>
	dial<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:1234&quot;</span><span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithInsecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Dial Error &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 延迟关闭链接</span>
	<span class="token keyword">defer</span> dial<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 实例化客户端</span>
	client <span class="token operator">:=</span> server<span class="token punctuation">.</span><span class="token function">NewHelloServiceClient</span><span class="token punctuation">(</span>dial<span class="token punctuation">)</span>
	<span class="token comment">// 发起请求</span>
	result<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>server<span class="token punctuation">.</span>HelloParam<span class="token punctuation">{</span>
		Name<span class="token punctuation">:</span>    <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
		Context<span class="token punctuation">:</span> <span class="token string">&quot;hello word!&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 打印返回信息</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-3-启动运行"><a href="#_3-3-启动运行" class="header-anchor">#</a> 3.3 启动运行</h4> <div class="language-go extra-class"><pre class="language-go"><code>Bash
# 启动服务端
➜ <span class="token keyword">go</span> run server<span class="token punctuation">.</span><span class="token keyword">go</span>
服务启动成功<span class="token operator">!</span>

# 启动客户端
➜  <span class="token keyword">go</span> run client<span class="token punctuation">.</span><span class="token keyword">go</span>
result<span class="token punctuation">:</span><span class="token string">&quot;张三 say hello word!&quot;</span>
</code></pre></div><h3 id="_4、oneof-只能选择一个"><a href="#_4、oneof-只能选择一个" class="header-anchor">#</a> 4、oneof(只能选择一个)</h3> <p>如果你有一个有很多字段的消息, 而同一时间最多只有一个字段会被设值, 你可以通过使用<code>oneof</code>特性来强化这个行为并节约内存.</p> <p>Oneof 字段和常见字段类似, 除了所有字段共用内存, 并且同一时间最多有一个字段可以设值. 设值<code>oneof</code>的任何成员都将自动清除所有其他成员. 可以通过使用特殊的case()或者WhichOneof()方法来检查oneof中的哪个值被设值了(如果有), 取决于不同语言.</p> <p>使用oneof关键字来在.proto中定义oneof, 后面跟oneof名字, 在这个例子中是test_oneof:</p> <div class="language-go extra-class"><pre class="language-go"><code>message SampleMessage <span class="token punctuation">{</span>
  oneof test_oneof <span class="token punctuation">{</span>
    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    SubMessage sub_message <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后再将oneof字段添加到oneof定义. 可以添加任意类型的字段, 但是不能使用重复(repeated)字段.</p> <p>在生成的代码中, oneof字段和普通字段一样有同样的getter和setter方法. 也会有一个特别的方法用来检查哪个值(如果有)被设置了,可以点击 <a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">API Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看更多。</p> <h4 id="_4-1-oneof特性"><a href="#_4-1-oneof特性" class="header-anchor">#</a> 4.1 oneof特性</h4> <ul><li>设置一个oneof字段会自动清除所有其他oneof成员. 所以如果设置多次oneof字段, 只有最后设置的字段依然有值.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code>SampleMessage message<span class="token punctuation">;</span>
message<span class="token punctuation">.</span><span class="token function">set_name</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">CHECK</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">has_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
message<span class="token punctuation">.</span><span class="token function">mutable_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Will clear name field.</span>
<span class="token function">CHECK</span><span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span><span class="token function">has_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>如果解析器遇到同一个oneof的多个成员, 只有看到的最后一个成员在被解析的消息中被使用.</li> <li>oneof不能是重复字段</li> <li>Reflection APIs work for oneof fields. (oneof字段用反射api来实现?)</li> <li>如果使用c++, 需要兼顾确认确认代码不会导致内存奔溃. 下面的示例代码会导致crash因为sub_message已经在调用set_name()方法时被删除.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code>SampleMessage message<span class="token punctuation">;</span>
SubMessage<span class="token operator">*</span> sub_message <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">mutable_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
message<span class="token punctuation">.</span><span class="token function">set_name</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Will delete sub_message</span>
sub_message<span class="token operator">-</span><span class="token operator">&gt;</span>set_<span class="token operator">...</span>            <span class="token comment">// Crashes here</span>
</code></pre></div><ul><li>同样在c++中, 如果通过调用Swap()来交换两个带有oneof的消息, 每个消息将会有另外一个消息的oneof: 在下面这个示例中, msg1将会有sub_message和msg2会有name.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code>SampleMessage msg1<span class="token punctuation">;</span>
msg1<span class="token punctuation">.</span><span class="token function">set_name</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SampleMessage msg2<span class="token punctuation">;</span>
msg2<span class="token punctuation">.</span><span class="token function">mutable_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
msg1<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">CHECK</span><span class="token punctuation">(</span>msg1<span class="token punctuation">.</span><span class="token function">has_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">CHECK</span><span class="token punctuation">(</span>msg2<span class="token punctuation">.</span><span class="token function">has_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>标签重用问题</p> <ul><li>将字段移入或者移出oneof: 消息被序列化和解析后, 可能丢失部分信息(某些字段可能被清除). 但是，可以安全地将单个字段移动到新的AAA中，并且如果已知只有一个字段被设置，还可以移动多个字段。</li> <li>删除oneof的一个字段又回来: 消息被序列化和解析后, 可能清除你当前设置的oneof字段</li> <li>拆分或者合并oneof: 和移动普通字段一样有类似问题</li></ul> <h4 id="_4-2-编写proto"><a href="#_4-2-编写proto" class="header-anchor">#</a> 4.2 编写<code>proto</code></h4> <p>修改上面的服务中的请求参数:<code>HelloParam</code>,</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 定义入参消息</span>
message HelloParam<span class="token punctuation">{</span>
  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> context <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token comment">// oneof 最多只能设置其中一个字段</span>
  oneof option <span class="token punctuation">{</span>
    <span class="token builtin">int32</span> age<span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> gender<span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-3-使用"><a href="#_4-3-使用" class="header-anchor">#</a> 4.3 使用</h4> <h5 id="_4-3-1-客户端传参"><a href="#_4-3-1-客户端传参" class="header-anchor">#</a> 4.3.1 客户端传参</h5> <p>生成<code>Go</code>代码后，入参只能设置其中一个值，如下</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// ...省略</span>
<span class="token comment">// 实例化客户端</span>
client <span class="token operator">:=</span> server<span class="token punctuation">.</span><span class="token function">NewHelloServiceClient</span><span class="token punctuation">(</span>dial<span class="token punctuation">)</span>
<span class="token comment">// 定义参数</span>
reqParam <span class="token operator">:=</span> <span class="token operator">&amp;</span>server<span class="token punctuation">.</span>HelloParam<span class="token punctuation">{</span>
  Name<span class="token punctuation">:</span>    <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
  Context<span class="token punctuation">:</span> <span class="token string">&quot;hello word!&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 只能设置其中一个</span>
reqParam<span class="token punctuation">.</span>Option <span class="token operator">=</span> <span class="token operator">&amp;</span>server<span class="token punctuation">.</span>HelloParam_Age<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">19</span><span class="token punctuation">}</span>
<span class="token comment">// 这个会替代上一个值</span>
<span class="token comment">//reqParam.Option = &amp;server.HelloParam_Gender{Gender: &quot;男&quot;}</span>
<span class="token comment">// 发起请求</span>
result<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqParam<span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><h5 id="_4-3-2-服务端接收参数"><a href="#_4-3-2-服务端接收参数" class="header-anchor">#</a> 4.3.2 服务端接收参数</h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>UnimplementedHelloServiceServer<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> p <span class="token operator">*</span>HelloParam<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//return nil, status.Errorf(codes.Unimplemented, &quot;method SayHello not implemented&quot;)</span>
	res <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;name:%s| gender:%s| age:%s | context:%s&quot;</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">GetGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">GetContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>HelloResult<span class="token punctuation">{</span>Result<span class="token punctuation">:</span>res<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5、any"><a href="#_5、any" class="header-anchor">#</a> 5、Any</h3> <p>Any 消息类型可以让你使用消息作为嵌入类型而不必持有他们的.proto定义. Any把任意序列化后的消息作为bytes包含, 带有一个URL, 工作起来类似一个全局唯一的标识符. 为了使用Any类型, 需要导入google/protobuf/any.proto.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;google/protobuf/any.proto&quot;</span><span class="token punctuation">;</span>

message ErrorStatus <span class="token punctuation">{</span>
  <span class="token builtin">string</span> message <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  repeated Any details <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>给定消息类型的 default type URL 是 <code>type.googleapis.com/packagename.messagename</code>.</p> <p>不同语言实现将提供运行时类库来帮助以类型安全的方式封包和解包Any的内容,例如, 在java中, Any类型将有特别的pack()和unpark()访问器, 而在c++中有PackFrom() 和 PackTo()方法:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 在Any中存储任务消息类型</span>
NetworkErrorDetails details <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
ErrorStatus status<span class="token punctuation">;</span>
status<span class="token punctuation">.</span><span class="token function">add_details</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">PackFrom</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 从Any中读取任意消息</span>
ErrorStatus status <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Any<span class="token operator">&amp;</span> detail <span class="token punctuation">:</span> status<span class="token punctuation">.</span><span class="token function">details</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>detail<span class="token punctuation">.</span>IsType<span class="token operator">&lt;</span>NetworkErrorDetails<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    NetworkErrorDetails network_error<span class="token punctuation">;</span>
    detail<span class="token punctuation">.</span><span class="token function">UnpackTo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>network_error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span> processing network_error <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-1-编写proto"><a href="#_5-1-编写proto" class="header-anchor">#</a> 5.1 编写<code>proto</code></h4> <div class="language-go extra-class"><pre class="language-go"><code>syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

option go_package <span class="token operator">=</span> <span class="token string">&quot;grpc/server&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用any类型，需要导入这个</span>
<span class="token keyword">import</span> <span class="token string">&quot;google/protobuf/any.proto&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 定义准备传的消息</span>
message Context <span class="token punctuation">{</span>
  <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> title <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 定义入参消息</span>
message HelloParam<span class="token punctuation">{</span>
  <span class="token comment">// any，代表可以是任何类型</span>
  google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Any data <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义出参消息</span>
message HelloResult <span class="token punctuation">{</span>
  <span class="token builtin">string</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-2-使用"><a href="#_5-2-使用" class="header-anchor">#</a> 5.2 使用</h4> <h5 id="_5-2-1-客户端传参"><a href="#_5-2-1-客户端传参" class="header-anchor">#</a> 5.2.1 客户端传参</h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">//...省略...</span>
	<span class="token comment">// 使用Any参数</span>
	content <span class="token operator">:=</span> <span class="token operator">&amp;</span>server<span class="token punctuation">.</span>Context<span class="token punctuation">{</span>
		Id<span class="token punctuation">:</span>    <span class="token number">100</span><span class="token punctuation">,</span>
		Title<span class="token punctuation">:</span> <span class="token string">&quot;Hello Word&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 序列化Any类型参数</span>
	any<span class="token punctuation">,</span> err <span class="token operator">:=</span> anypb<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;any 类型参数序列化失败&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
  <span class="token comment">// 注意这里，一开始在proto文件中，没有定义使用消息类型Context，</span>
  <span class="token comment">// 现在通过any类型，同样可以使用</span>
	reqParam <span class="token operator">:=</span> <span class="token operator">&amp;</span>server<span class="token punctuation">.</span>HelloParam<span class="token punctuation">{</span>Data<span class="token punctuation">:</span> any<span class="token punctuation">}</span>
	<span class="token comment">// 发起请求</span>
	result<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqParam<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
<span class="token comment">// ....省略...</span>
</code></pre></div><h5 id="_5-2-2-服务端接收参数"><a href="#_5-2-2-服务端接收参数" class="header-anchor">#</a> 5.2.2 服务端接收参数</h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>UnimplementedHelloServiceServer<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> p <span class="token operator">*</span>HelloParam<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>HelloResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> context Context
  <span class="token comment">// 反序列化参数</span>
	p<span class="token punctuation">.</span>Data<span class="token punctuation">.</span><span class="token function">UnmarshalTo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>context<span class="token punctuation">)</span>
	res <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%v|%v&quot;</span><span class="token punctuation">,</span>context<span class="token punctuation">.</span><span class="token function">GetId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>context<span class="token punctuation">.</span><span class="token function">GetTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>HelloResult<span class="token punctuation">{</span>Result<span class="token punctuation">:</span> res<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">nil</span>
	<span class="token comment">//return nil, status.Errorf(codes.Unimplemented, &quot;method SayHello not implemented&quot;)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="六、额外的数据类型支持"><a href="#六、额外的数据类型支持" class="header-anchor">#</a> 六、额外的数据类型支持</h2> <p>协议缓冲区支持许多标量值类型，包括使用可变长度编码和固定大小的整数。您还可以通过定义消息来创建自己的复合数据类型，这些消息本身就是可以分配给字段的数据类型。除了简单和复合值类型之外，还发布了几种常见类型。</p> <h3 id="_1、常见类型"><a href="#_1、常见类型" class="header-anchor">#</a> 1、常见类型</h3> <ul><li><a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/duration.proto" target="_blank" rel="noopener noreferrer"><code>Duration</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是有符号的、固定长度的时间跨度，例如 42 秒。</li> <li><a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/timestamp.proto" target="_blank" rel="noopener noreferrer"><code>Timestamp</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是独立于任何时区或日历的时间点，例如 2017-01-15T01:30:15.01Z。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/interval.proto" target="_blank" rel="noopener noreferrer"><code>Interval</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是独立于时区或日历的时间间隔，例如 2017-01-15T01:30:15.01Z - 2017-01-16T02:30:15.01Z。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/date.proto" target="_blank" rel="noopener noreferrer"><code>Date</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个完整的日历日期，例如 2025-09-19。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/dayofweek.proto" target="_blank" rel="noopener noreferrer"><code>DayOfWeek</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一周中的某一天，例如星期一。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/timeofday.proto" target="_blank" rel="noopener noreferrer"><code>TimeOfDay</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一天中的某个时间，例如 10:42:23。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/latlng.proto" target="_blank" rel="noopener noreferrer"><code>LatLng</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个纬度/经度对，例如 37.386051 纬度和 -122.083855 经度。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/money.proto" target="_blank" rel="noopener noreferrer"><code>Money</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是具有货币类型的金额，例如 42 美元。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/postal_address.proto" target="_blank" rel="noopener noreferrer"><code>PostalAddress</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是邮政地址，例如 1600 Amphitheatre Parkway Mountain View, CA 94043 USA。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/color.proto" target="_blank" rel="noopener noreferrer"><code>Color</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 RGBA 颜色空间中的一种颜色。</li> <li><a href="https://github.com/googleapis/googleapis/blob/master/google/type/month.proto" target="_blank" rel="noopener noreferrer"><code>Month</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一年中的一个月，例如四月。</li></ul> <h3 id="_2、协议缓冲区开源哲学"><a href="#_2、协议缓冲区开源哲学" class="header-anchor">#</a> 2、协议缓冲区开源哲学</h3> <p>协议缓冲区于 2008 年开源，旨在为 Google 以外的开发人员提供与我们在内部从中获得的相同好处的一种方式。我们通过定期更新语言来支持开源社区，因为我们进行这些更改以支持我们的内部需求。虽然我们接受来自外部开发人员的精选拉取请求，但我们不能始终优先考虑不符合 Google 特定需求的功能请求和错误修复。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>https://developers.google.com/protocol-buffers/docs/overview</li> <li><a href="http://liuqh.icu/2022/02/08/go/rpc/04-protobuf/" target="_blank" rel="noopener noreferrer">RPC编程(四):protobuf语法学习<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2022/5/23 下午4:38:26</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/east-white/go/advanced/gRPC/2_proto2/">
            2、proto2
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#一、协议缓冲区解决了哪些问题" class="sidebar-link reco-side-一、协议缓冲区解决了哪些问题" data-v-cb1513f6>一、协议缓冲区解决了哪些问题？</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#二、使用协议缓冲区有什么好处" class="sidebar-link reco-side-二、使用协议缓冲区有什么好处" data-v-cb1513f6>二、使用协议缓冲区有什么好处？</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_1、跨语言兼容性" class="sidebar-link reco-side-_1、跨语言兼容性" data-v-cb1513f6>1、跨语言兼容性</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_2、跨项目支持" class="sidebar-link reco-side-_2、跨项目支持" data-v-cb1513f6>2、跨项目支持</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_3、在不更新代码的情况下更新原型定义" class="sidebar-link reco-side-_3、在不更新代码的情况下更新原型定义" data-v-cb1513f6>3、在不更新代码的情况下更新原型定义</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_4、什么时候协议缓冲区不适合" class="sidebar-link reco-side-_4、什么时候协议缓冲区不适合" data-v-cb1513f6>4、什么时候协议缓冲区不适合？</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_5、xml、json、protobuf对比" class="sidebar-link reco-side-_5、xml、json、protobuf对比" data-v-cb1513f6>5、XML、JSON、Protobuf对比</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#三、谁使用协议缓冲区" class="sidebar-link reco-side-三、谁使用协议缓冲区" data-v-cb1513f6>三、谁使用协议缓冲区？</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#四、协议缓冲区如何工作" class="sidebar-link reco-side-四、协议缓冲区如何工作" data-v-cb1513f6>四、协议缓冲区如何工作？</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#五、协议缓冲区定义语法" class="sidebar-link reco-side-五、协议缓冲区定义语法" data-v-cb1513f6>五、协议缓冲区定义语法</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_1、简单类型与go对应" class="sidebar-link reco-side-_1、简单类型与go对应" data-v-cb1513f6>1、简单类型与Go对应</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_2、保留标识符-reserved" class="sidebar-link reco-side-_2、保留标识符-reserved" data-v-cb1513f6>2、保留标识符(reserved)</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_3、枚举类型" class="sidebar-link reco-side-_3、枚举类型" data-v-cb1513f6>3、枚举类型</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_4、嵌套消息" class="sidebar-link reco-side-_4、嵌套消息" data-v-cb1513f6>4、嵌套消息</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_5、map类型消息" class="sidebar-link reco-side-_5、map类型消息" data-v-cb1513f6>5、map类型消息</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_6、切片-数组-类型消息" class="sidebar-link reco-side-_6、切片-数组-类型消息" data-v-cb1513f6>6、切片(数组)类型消息</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_7、引入其他proto文件" class="sidebar-link reco-side-_7、引入其他proto文件" data-v-cb1513f6>7、引入其他proto文件</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_8、import-proto" class="sidebar-link reco-side-_8、import-proto" data-v-cb1513f6>8、import proto</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#六、定义服务-service" class="sidebar-link reco-side-六、定义服务-service" data-v-cb1513f6>六、定义服务(Service)</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_1、编写service" class="sidebar-link reco-side-_1、编写service" data-v-cb1513f6>1、编写service</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_2、生成go代码" class="sidebar-link reco-side-_2、生成go代码" data-v-cb1513f6>2、生成Go代码</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_3、运行服务" class="sidebar-link reco-side-_3、运行服务" data-v-cb1513f6>3、运行服务</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_4、oneof-只能选择一个" class="sidebar-link reco-side-_4、oneof-只能选择一个" data-v-cb1513f6>4、oneof(只能选择一个)</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_5、any" class="sidebar-link reco-side-_5、any" data-v-cb1513f6>5、Any</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#六、额外的数据类型支持" class="sidebar-link reco-side-六、额外的数据类型支持" data-v-cb1513f6>六、额外的数据类型支持</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_1、常见类型" class="sidebar-link reco-side-_1、常见类型" data-v-cb1513f6>1、常见类型</a></li><li class="level-3" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#_2、协议缓冲区开源哲学" class="sidebar-link reco-side-_2、协议缓冲区开源哲学" data-v-cb1513f6>2、协议缓冲区开源哲学</a></li><li class="level-2" data-v-cb1513f6><a href="/east-white/go/advanced/gRPC/1_preface/#参考" class="sidebar-link reco-side-参考" data-v-cb1513f6>参考</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://www.ytmp3.cn/down/51750.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:10px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/east_white.jpeg?param=200y200" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://ian-kevin.oss-cn-beijing.aliyuncs.com/img/east_white.jpeg?param=200y200);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>River flows in you</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Yiruma</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><!----></div></div>
    <script src="/east-white/assets/js/app.66c0ecb2.js" defer></script><script src="/east-white/assets/js/3.688d5389.js" defer></script><script src="/east-white/assets/js/1.66f91b48.js" defer></script><script src="/east-white/assets/js/42.2b7e1b2a.js" defer></script>
  </body>
</html>
